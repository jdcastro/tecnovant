<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.1"/>
    <title>app.core.models API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../core.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;app.core</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#RoleEnum">RoleEnum</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#RoleEnum.ADMINISTRATOR">ADMINISTRATOR</a>
                        </li>
                        <li>
                                <a class="variable" href="#RoleEnum.RESELLER">RESELLER</a>
                        </li>
                        <li>
                                <a class="variable" href="#RoleEnum.ORG_ADMIN">ORG_ADMIN</a>
                        </li>
                        <li>
                                <a class="variable" href="#RoleEnum.ORG_EDITOR">ORG_EDITOR</a>
                        </li>
                        <li>
                                <a class="variable" href="#RoleEnum.ORG_VIEWER">ORG_VIEWER</a>
                        </li>
                        <li>
                                <a class="variable" href="#RoleEnum.id">id</a>
                        </li>
                        <li>
                                <a class="variable" href="#RoleEnum.description">description</a>
                        </li>
                        <li>
                                <a class="variable" href="#RoleEnum.value">value</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ActionEnum">ActionEnum</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ActionEnum.CREATE">CREATE</a>
                        </li>
                        <li>
                                <a class="variable" href="#ActionEnum.READ">READ</a>
                        </li>
                        <li>
                                <a class="variable" href="#ActionEnum.UPDATE">UPDATE</a>
                        </li>
                        <li>
                                <a class="variable" href="#ActionEnum.DELETE">DELETE</a>
                        </li>
                        <li>
                                <a class="variable" href="#ActionEnum.MANAGE">MANAGE</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#PermissionEnum">PermissionEnum</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#PermissionEnum.FULL_MANAGEMENT">FULL_MANAGEMENT</a>
                        </li>
                        <li>
                                <a class="variable" href="#PermissionEnum.ORG_MANAGEMENT">ORG_MANAGEMENT</a>
                        </li>
                        <li>
                                <a class="variable" href="#PermissionEnum.CONTENT_MANAGEMENT">CONTENT_MANAGEMENT</a>
                        </li>
                        <li>
                                <a class="variable" href="#PermissionEnum.REPORTING">REPORTING</a>
                        </li>
                        <li>
                                <a class="variable" href="#PermissionEnum.SYSTEM_SETTINGS">SYSTEM_SETTINGS</a>
                        </li>
                        <li>
                                <a class="variable" href="#PermissionEnum.LIMITED_REPORTS">LIMITED_REPORTS</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#ROLE_PERMISSIONS">ROLE_PERMISSIONS</a>
            </li>
            <li>
                    <a class="variable" href="#PERMISSION_ACTIONS">PERMISSION_ACTIONS</a>
            </li>
            <li>
                    <a class="variable" href="#user_organization">user_organization</a>
            </li>
            <li>
                    <a class="function" href="#short_uuid">short_uuid</a>
            </li>
            <li>
                    <a class="class" href="#User">User</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#User.__init__">User</a>
                        </li>
                        <li>
                                <a class="variable" href="#User.id">id</a>
                        </li>
                        <li>
                                <a class="variable" href="#User.username">username</a>
                        </li>
                        <li>
                                <a class="variable" href="#User.email">email</a>
                        </li>
                        <li>
                                <a class="variable" href="#User.full_name">full_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#User.password_hash">password_hash</a>
                        </li>
                        <li>
                                <a class="variable" href="#User.profile_data">profile_data</a>
                        </li>
                        <li>
                                <a class="variable" href="#User.created_at">created_at</a>
                        </li>
                        <li>
                                <a class="variable" href="#User.updated_at">updated_at</a>
                        </li>
                        <li>
                                <a class="variable" href="#User.active">active</a>
                        </li>
                        <li>
                                <a class="variable" href="#User.role">role</a>
                        </li>
                        <li>
                                <a class="variable" href="#User.reseller_packages">reseller_packages</a>
                        </li>
                        <li>
                                <a class="variable" href="#User.organizations">organizations</a>
                        </li>
                        <li>
                                <a class="function" href="#User.set_password">set_password</a>
                        </li>
                        <li>
                                <a class="function" href="#User.check_password">check_password</a>
                        </li>
                        <li>
                                <a class="function" href="#User.has_permission">has_permission</a>
                        </li>
                        <li>
                                <a class="function" href="#User.is_admin">is_admin</a>
                        </li>
                        <li>
                                <a class="function" href="#User.is_reseller">is_reseller</a>
                        </li>
                        <li>
                                <a class="function" href="#User.is_org_manager">is_org_manager</a>
                        </li>
                        <li>
                                <a class="function" href="#User.is_client_user">is_client_user</a>
                        </li>
                        <li>
                                <a class="function" href="#User.have_role">have_role</a>
                        </li>
                        <li>
                                <a class="function" href="#User.get_role">get_role</a>
                        </li>
                        <li>
                                <a class="function" href="#User.get_by_username">get_by_username</a>
                        </li>
                        <li>
                                <a class="function" href="#User.get_by_email">get_by_email</a>
                        </li>
                        <li>
                                <a class="function" href="#User.assign_organization">assign_organization</a>
                        </li>
                        <li>
                                <a class="function" href="#User.unassign_organization">unassign_organization</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Organization">Organization</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Organization.__init__">Organization</a>
                        </li>
                        <li>
                                <a class="variable" href="#Organization.id">id</a>
                        </li>
                        <li>
                                <a class="variable" href="#Organization.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#Organization.description">description</a>
                        </li>
                        <li>
                                <a class="variable" href="#Organization.profile_data">profile_data</a>
                        </li>
                        <li>
                                <a class="variable" href="#Organization.reseller_id">reseller_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#Organization.created_at">created_at</a>
                        </li>
                        <li>
                                <a class="variable" href="#Organization.updated_at">updated_at</a>
                        </li>
                        <li>
                                <a class="variable" href="#Organization.active">active</a>
                        </li>
                        <li>
                                <a class="variable" href="#Organization.reseller_package">reseller_package</a>
                        </li>
                        <li>
                                <a class="variable" href="#Organization.get_reseller">get_reseller</a>
                        </li>
                        <li>
                                <a class="function" href="#Organization.get_users">get_users</a>
                        </li>
                        <li>
                                <a class="variable" href="#Organization.users">users</a>
                        </li>
                        <li>
                                <a class="variable" href="#Organization.farms">farms</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ResellerPackage">ResellerPackage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ResellerPackage.__init__">ResellerPackage</a>
                        </li>
                        <li>
                                <a class="variable" href="#ResellerPackage.id">id</a>
                        </li>
                        <li>
                                <a class="variable" href="#ResellerPackage.reseller_id">reseller_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#ResellerPackage.max_clients">max_clients</a>
                        </li>
                        <li>
                                <a class="variable" href="#ResellerPackage.current_clients">current_clients</a>
                        </li>
                        <li>
                                <a class="function" href="#ResellerPackage.add_client">add_client</a>
                        </li>
                        <li>
                                <a class="function" href="#ResellerPackage.increase_client">increase_client</a>
                        </li>
                        <li>
                                <a class="function" href="#ResellerPackage.decrease_client">decrease_client</a>
                        </li>
                        <li>
                                <a class="function" href="#ResellerPackage.get_available_slots">get_available_slots</a>
                        </li>
                        <li>
                                <a class="function" href="#ResellerPackage.assign_client">assign_client</a>
                        </li>
                        <li>
                                <a class="function" href="#ResellerPackage.unassign_client">unassign_client</a>
                        </li>
                        <li>
                                <a class="function" href="#ResellerPackage.get_all_users_clients">get_all_users_clients</a>
                        </li>
                        <li>
                                <a class="variable" href="#ResellerPackage.reseller">reseller</a>
                        </li>
                        <li>
                                <a class="variable" href="#ResellerPackage.organizations">organizations</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#check_permission">check_permission</a>
            </li>
            <li>
                    <a class="function" href="#verify_user_credentials">verify_user_credentials</a>
            </li>
            <li>
                    <a class="function" href="#verify_user_in_organization">verify_user_in_organization</a>
            </li>
            <li>
                    <a class="function" href="#get_clients_for_user">get_clients_for_user</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../app.html">app</a><wbr>.<a href="./../core.html">core</a><wbr>.models    </h1>

                        <div class="docstring"><p>Documentation of the model:
This SQLAlchemy model implements a role and permission-based access control system, designed to manage users, their roles, permissions, and associated actions within a reseller schema. It also includes models for clients (organizations), reseller limits, and system modules.</p>

<p>Permission Management:
The roles, actions, and permissions model is managed statically with enumerations.
The definition of roles, actions, and permissions is done using enums to make the structure very clear and easy to maintain.
Changes to permissions or roles can be managed centrally in the enums and associated dictionaries.</p>
</div>

                        <input id="mod-models-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-models-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">User model roles, permissions and actions</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">module for Yet Another Flask Survival Kit (YAFSK)</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">Author: Johnny De Castro</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">Email: j@jdcastro.co</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">Copyright (c) 2024 - 2025 Johnny De Castro.</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">All rights reserved.</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">Licensed under the Apache License, Version 2.0</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="c1"># Python standard library imports</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">lru_cache</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">threading</span><span class="w"> </span><span class="kn">import</span> <span class="n">Timer</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span><span class="o">,</span><span class="w"> </span><span class="nn">weakref</span><span class="o">,</span><span class="w"> </span><span class="nn">uuid</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="c1"># Third party imports</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">werkzeug.security</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_password_hash</span><span class="p">,</span> <span class="n">generate_password_hash</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">joinedload</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="c1"># Local application imports</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">app.extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">db</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="s2">Documentation of the model:</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="s2">This SQLAlchemy model implements a role and permission-based access control system, designed to manage users, their roles, permissions, and associated actions within a reseller schema. It also includes models for clients (organizations), reseller limits, and system modules.</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="s2">Permission Management:</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="s2">The roles, actions, and permissions model is managed statically with enumerations.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="s2">The definition of roles, actions, and permissions is done using enums to make the structure very clear and easy to maintain.</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="s2">Changes to permissions or roles can be managed centrally in the enums and associated dictionaries.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="c1"># 1. Enumeraciones (Enums):</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="k">class</span><span class="w"> </span><span class="nc">RoleEnum</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;RoleEnum: Defines the predefined roles within the system</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    (administrator, reseller, organization administrator, organization editor, organization viewer).</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>    <span class="n">ADMINISTRATOR</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;administrator&quot;</span><span class="p">,</span> <span class="s2">&quot;Administrador&quot;</span><span class="p">)</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>    <span class="n">RESELLER</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;reseller&quot;</span><span class="p">,</span> <span class="s2">&quot;Revendedor&quot;</span><span class="p">)</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>    <span class="n">ORG_ADMIN</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;org_admin&quot;</span><span class="p">,</span> <span class="s2">&quot;Administrador de Organización&quot;</span><span class="p">)</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>    <span class="n">ORG_EDITOR</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;org_editor&quot;</span><span class="p">,</span> <span class="s2">&quot;Editor de Organización&quot;</span><span class="p">)</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>    <span class="n">ORG_VIEWER</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;org_viewer&quot;</span><span class="p">,</span> <span class="s2">&quot;Visor de Organización&quot;</span><span class="p">)</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>    <span class="nd">@property</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">        Devuelve el valor del rol.</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ActionEnum</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;ActionEnum: Define las acciones posibles</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">    (crear, leer, actualizar, eliminar, administrar).&quot;&quot;&quot;</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>    <span class="n">CREATE</span> <span class="o">=</span> <span class="s2">&quot;create&quot;</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>    <span class="n">READ</span> <span class="o">=</span> <span class="s2">&quot;read&quot;</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>    <span class="n">UPDATE</span> <span class="o">=</span> <span class="s2">&quot;update&quot;</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>    <span class="n">DELETE</span> <span class="o">=</span> <span class="s2">&quot;delete&quot;</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>    <span class="n">MANAGE</span> <span class="o">=</span> <span class="s2">&quot;manage&quot;</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="k">class</span><span class="w"> </span><span class="nc">PermissionEnum</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;PermissionEnum: Define los permisos disponibles</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">    (gestión completa, gestión de organización, gestión de contenido, informes, ajustes del sistema, informes limitados).</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>    <span class="n">FULL_MANAGEMENT</span> <span class="o">=</span> <span class="s2">&quot;full_management&quot;</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>    <span class="n">ORG_MANAGEMENT</span> <span class="o">=</span> <span class="s2">&quot;org_management&quot;</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>    <span class="n">CONTENT_MANAGEMENT</span> <span class="o">=</span> <span class="s2">&quot;content_management&quot;</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>    <span class="n">REPORTING</span> <span class="o">=</span> <span class="s2">&quot;reporting&quot;</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>    <span class="n">SYSTEM_SETTINGS</span> <span class="o">=</span> <span class="s2">&quot;system_settings&quot;</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>    <span class="n">LIMITED_REPORTS</span> <span class="o">=</span> <span class="s2">&quot;limited_reports&quot;</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="c1"># Definir permisos por rol</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="n">ROLE_PERMISSIONS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>    <span class="n">RoleEnum</span><span class="o">.</span><span class="n">ADMINISTRATOR</span><span class="p">:</span> <span class="p">[</span><span class="n">PermissionEnum</span><span class="o">.</span><span class="n">FULL_MANAGEMENT</span><span class="p">],</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>    <span class="n">RoleEnum</span><span class="o">.</span><span class="n">RESELLER</span><span class="p">:</span> <span class="p">[</span><span class="n">PermissionEnum</span><span class="o">.</span><span class="n">ORG_MANAGEMENT</span><span class="p">],</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>    <span class="n">RoleEnum</span><span class="o">.</span><span class="n">ORG_ADMIN</span><span class="p">:</span> <span class="p">[</span><span class="n">PermissionEnum</span><span class="o">.</span><span class="n">CONTENT_MANAGEMENT</span><span class="p">,</span> <span class="n">PermissionEnum</span><span class="o">.</span><span class="n">REPORTING</span><span class="p">],</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>    <span class="n">RoleEnum</span><span class="o">.</span><span class="n">ORG_EDITOR</span><span class="p">:</span> <span class="p">[</span><span class="n">PermissionEnum</span><span class="o">.</span><span class="n">REPORTING</span><span class="p">],</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>    <span class="n">RoleEnum</span><span class="o">.</span><span class="n">ORG_VIEWER</span><span class="p">:</span> <span class="p">[</span><span class="n">PermissionEnum</span><span class="o">.</span><span class="n">REPORTING</span><span class="p">],</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="p">}</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="c1"># Definir acciones permitidas por permiso</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="n">PERMISSION_ACTIONS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>    <span class="n">PermissionEnum</span><span class="o">.</span><span class="n">FULL_MANAGEMENT</span><span class="p">:</span> <span class="p">[</span><span class="n">action</span> <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">ActionEnum</span><span class="p">],</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>    <span class="n">PermissionEnum</span><span class="o">.</span><span class="n">ORG_MANAGEMENT</span><span class="p">:</span> <span class="p">[</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>        <span class="n">ActionEnum</span><span class="o">.</span><span class="n">CREATE</span><span class="p">,</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="n">ActionEnum</span><span class="o">.</span><span class="n">READ</span><span class="p">,</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>        <span class="n">ActionEnum</span><span class="o">.</span><span class="n">UPDATE</span><span class="p">,</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>        <span class="n">ActionEnum</span><span class="o">.</span><span class="n">DELETE</span><span class="p">,</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>    <span class="p">],</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>    <span class="n">PermissionEnum</span><span class="o">.</span><span class="n">CONTENT_MANAGEMENT</span><span class="p">:</span> <span class="p">[</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>        <span class="n">ActionEnum</span><span class="o">.</span><span class="n">CREATE</span><span class="p">,</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>        <span class="n">ActionEnum</span><span class="o">.</span><span class="n">READ</span><span class="p">,</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>        <span class="n">ActionEnum</span><span class="o">.</span><span class="n">UPDATE</span><span class="p">,</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>    <span class="p">],</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>    <span class="n">PermissionEnum</span><span class="o">.</span><span class="n">REPORTING</span><span class="p">:</span> <span class="p">[</span><span class="n">ActionEnum</span><span class="o">.</span><span class="n">READ</span><span class="p">],</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="p">}</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="c1"># tables</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="n">user_organization</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>    <span class="s2">&quot;user_organization&quot;</span><span class="p">,</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>    <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">36</span><span class="p">),</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;users.id&quot;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>    <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>        <span class="s2">&quot;organization_id&quot;</span><span class="p">,</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;organizations.id&quot;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;CASCADE&quot;</span><span class="p">),</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>        <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>    <span class="p">),</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>    <span class="n">db</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="s2">&quot;ix_user_organization_user_id&quot;</span><span class="p">,</span> <span class="s2">&quot;user_id&quot;</span><span class="p">),</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>    <span class="n">db</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="s2">&quot;ix_user_organization_organization_id&quot;</span><span class="p">,</span> <span class="s2">&quot;organization_id&quot;</span><span class="p">),</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>    <span class="c1"># &quot;Tabla de relación entre usuarios y organizaciones.&quot;,</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="p">)</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="k">def</span><span class="w"> </span><span class="nf">short_uuid</span><span class="p">():</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>    <span class="k">return</span> <span class="nb">hex</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">int</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>  <span class="c1"># 8 caracteres hexadecimales</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="c1"># Clases</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Modelo que representa a los usuarios del sistema.</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">    Gestiona la información personal, credenciales de acceso, roles,</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">    y la pertenencia a organizaciones (clientes).</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;users&quot;</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>        <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="n">default</span><span class="o">=</span><span class="n">short_uuid</span><span class="p">,</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Clave primaria única del usuario en formato UUID.&quot;</span><span class="p">,</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>    <span class="p">)</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>    <span class="n">username</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">80</span><span class="p">),</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>        <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Nombre de usuario (String, único, no nulo, indexado). Utilizado para el login.&quot;</span><span class="p">,</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>    <span class="p">)</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>    <span class="n">email</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">120</span><span class="p">),</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>        <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>        <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Dirección de correo electrónico (String, único, no nulo, indexado).&quot;</span><span class="p">,</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>    <span class="p">)</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>    <span class="n">full_name</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">128</span><span class="p">),</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Nombre completo del usuario (String, no nulo).&quot;</span><span class="p">,</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>    <span class="p">)</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>    <span class="n">password_hash</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Hash de la contraseña (String). Almacena la contraseña de forma segura.&quot;</span><span class="p">,</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>    <span class="p">)</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>    <span class="n">profile_data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">JSON</span><span class="p">,</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>        <span class="n">default</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Datos adicionales del perfil (JSON, valor por defecto: diccionario vacío). Permite almacenar información extra específica del usuario.&quot;</span><span class="p">,</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>    <span class="p">)</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>    <span class="n">created_at</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">DateTime</span><span class="p">,</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">,</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Fecha de creación del usuario (DateTime).&quot;</span><span class="p">,</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>    <span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">DateTime</span><span class="p">,</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>        <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">,</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="n">onupdate</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">,</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Fecha de última actualización del usuario (DateTime). Se actualiza automáticamente.&quot;</span><span class="p">,</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>    <span class="p">)</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>    <span class="n">active</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">Boolean</span><span class="p">,</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Estado de la cuenta (Boolean, valor por defecto: True). Indica si la cuenta está activa o inactiva.&quot;</span><span class="p">,</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>    <span class="p">)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>    <span class="n">role</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="n">RoleEnum</span><span class="p">),</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="n">default</span><span class="o">=</span><span class="n">RoleEnum</span><span class="o">.</span><span class="n">ORG_VIEWER</span><span class="p">,</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Rol del usuario (Enum, no nulo, valor por defecto: ORG_VIEWER). Define el rol del usuario en el sistema.&quot;</span><span class="p">,</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>    <span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>    <span class="c1"># Relaciones</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>    <span class="n">reseller_packages</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        <span class="s2">&quot;ResellerPackage&quot;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;reseller&quot;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="s2">&quot;dynamic&quot;</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>    <span class="p">)</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>    <span class="n">organizations</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>        <span class="s2">&quot;Organization&quot;</span><span class="p">,</span> <span class="n">secondary</span><span class="o">=</span><span class="n">user_organization</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;users&quot;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="s2">&quot;dynamic&quot;</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>    <span class="p">)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Representación en cadena del objeto User.</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="sd">        Returns:</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">            str: Representación en cadena del usuario.</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;User </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">        Establece un hash seguro para la contraseña del usuario.</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">        Args:</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">            password (str): La contraseña en texto plano.</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">        Raises:</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">            ValueError: Si la contraseña no cumple con los requisitos de seguridad.</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">password_hash</span> <span class="o">=</span> <span class="n">generate_password_hash</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">        Verifica si la contraseña proporcionada coincide con el hash almacenado.</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">        Args:</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">            password (str): La contraseña en texto plano a verificar.</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">        Returns:</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">            bool: True si la contraseña coincide, False en caso contrario.</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>        <span class="k">return</span> <span class="n">check_password_hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">password_hash</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">has_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">permission_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">client_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">        Verifica si el usuario tiene un permiso específico y opcionalmente dentro de un cliente específico.</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">        Args:</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">            permission_name (str): Nombre del permiso a verificar (ej: &#39;full_management&#39;).</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">            action_name (str): Nombre de la acción a verificar (ej: &#39;create&#39;).</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">            client_id (int, optional): ID del cliente para verificar el permiso dentro de ese cliente. Defaults to None.</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">        Returns:</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">            bool: True si el usuario tiene el permiso y la acción especificados, False en caso contrario.</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>            <span class="n">perm_enum</span> <span class="o">=</span> <span class="n">PermissionEnum</span><span class="p">(</span><span class="n">permission_name</span><span class="p">)</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>            <span class="n">action_enum</span> <span class="o">=</span> <span class="n">ActionEnum</span><span class="p">(</span><span class="n">action_name</span><span class="p">)</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>            <span class="c1"># Verificar si el permiso está asignado al rol del usuario</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>            <span class="k">if</span> <span class="n">perm_enum</span> <span class="ow">in</span> <span class="n">ROLE_PERMISSIONS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">role</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>                <span class="c1"># Verificar si la acción está permitida para ese permiso</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>                <span class="k">if</span> <span class="n">action_enum</span> <span class="ow">in</span> <span class="n">PERMISSION_ACTIONS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perm_enum</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>                    <span class="k">if</span> <span class="n">client_id</span><span class="p">:</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span> <span class="o">==</span> <span class="n">client_id</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_admin</span><span class="p">()</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>                    <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>            <span class="c1"># Si alguno de los valores no está en las enumeraciones, retornar False</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_admin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="sd">        Verifica si el usuario tiene el rol de administrador.</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="sd">        Returns:</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="sd">            bool: True si el usuario tiene el rol de administrador, False en caso contrario.</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="n">RoleEnum</span><span class="o">.</span><span class="n">ADMINISTRATOR</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_reseller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="sd">        Verifica si el usuario tiene el rol de reseller.</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">        Returns:</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">            bool: True si el usuario tiene el rol de reseller, False en caso contrario.</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="n">RoleEnum</span><span class="o">.</span><span class="n">RESELLER</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_org_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="sd">        Verifica si es un administrador de organización.</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="sd">        Returns:</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="sd">            bool: True si es un administrador de organización, False en caso contrario.</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="n">RoleEnum</span><span class="o">.</span><span class="n">ORG_ADMIN</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_client_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">):</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="sd">        Verifica si el usuario pertenece a un cliente específico.</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="sd">        Args:</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="sd">            client_id (int): El ID del cliente a verificar.</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="sd">        Returns:</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="sd">            bool: True si el usuario pertenece al cliente, False en caso contrario.</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span> <span class="o">==</span> <span class="n">client_id</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">have_role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role</span><span class="p">):</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="sd">        Verifica si el usuario tiene un rol específico.</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="sd">        Args:</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">            role (RoleEnum): El rol a verificar.</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">        Returns:</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">            bool: True si el usuario tiene el rol especificado, False en caso contrario.</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="n">role</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_role</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Mostrar el nombre descriptivo del rol&quot;&quot;&quot;</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span><span class="o">.</span><span class="n">description</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_by_username</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">        Obtiene un usuario por su nombre de usuario.</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">        Args:</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">            username (str): Nombre de usuario.</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">        Returns:</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="sd">            User or None: El usuario si existe, None en caso contrario.</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>    <span class="c1"># @lru_cache(maxsize=32)</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_by_email</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">):</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="sd">        Obtiene un usuario por su correo electrónico.</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="sd">        Args:</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">            email (str): Correo electrónico.</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a><span class="sd">        Returns:</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="sd">            User or None: El usuario si existe, None en caso contrario.</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">assign_organization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organization_id</span><span class="p">):</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">        Asigna una organización a este usuario.</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="sd">        Args:</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">            organization_id (int): ID de la organización a asignar.</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>        <span class="n">organization</span> <span class="o">=</span> <span class="n">Organization</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">organization_id</span><span class="p">)</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>        <span class="k">if</span> <span class="n">organization</span><span class="p">:</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">organizations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">organization</span><span class="p">)</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unassign_organization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organization_id</span><span class="p">):</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="sd">        Desasigna una organización de este usuario.</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a><span class="sd">        Args:</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">            organization_id (int): ID de la organización a desasignar.</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>        <span class="n">organization</span> <span class="o">=</span> <span class="n">Organization</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">organization_id</span><span class="p">)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>        <span class="k">if</span> <span class="n">organization</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">organizations</span><span class="p">:</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">organizations</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">organization</span><span class="p">)</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Organization</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Modelo que representa a los clientes u organizaciones en el sistema.&quot;&quot;&quot;</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;organizations&quot;</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> 
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>        <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Clave primaria única del cliente.&quot;</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>    <span class="p">)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> 
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Nombre del cliente (String, no nulo).&quot;</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>    <span class="p">)</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>    <span class="n">description</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Descripción del cliente. Proporciona información adicional sobre el cliente u organización.&quot;</span><span class="p">,</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>    <span class="p">)</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>    <span class="n">profile_data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">JSON</span><span class="p">,</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="n">default</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Datos adicionales del cliente (JSON, valor por defecto: diccionario vacío). Permite almacenar información extra específica del cliente.&quot;</span><span class="p">,</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>    <span class="p">)</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>    <span class="n">reseller_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;reseller_packages.id&quot;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;SET NULL&quot;</span><span class="p">),</span>  
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>        <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Relación opcional con el paquete de reseller&quot;</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>    <span class="p">)</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>    <span class="n">created_at</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">DateTime</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Fecha de creación del cliente.&quot;</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>    <span class="p">)</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">DateTime</span><span class="p">,</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>        <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">,</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>        <span class="n">onupdate</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">,</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Fecha de última actualización del cliente.&quot;</span><span class="p">,</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>    <span class="p">)</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>    <span class="n">active</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">Boolean</span><span class="p">,</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Estado del cliente (Boolean, valor por defecto: True). Indica si el cliente está activo o inactivo.&quot;</span><span class="p">,</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>    <span class="p">)</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>    <span class="c1"># Relación con ResellerPackage</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>    <span class="n">reseller_package</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;ResellerPackage&quot;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;organizations&quot;</span><span class="p">)</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Representación en cadena del objeto Organization.</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="sd">        Returns:</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="sd">            str: Representación en cadena del cliente.</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;Organization </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>    <span class="nd">@property</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_reseller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a><span class="sd">        Obtiene el usuario reseller asociado a la organización, si existe.</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="sd">        Returns:</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">            User or None: El usuario reseller si existe, None en caso contrario</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reseller_package</span><span class="p">:</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>            <span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reseller_package</span><span class="o">.</span><span class="n">reseller_id</span><span class="p">)</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_users</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="sd">        Devuelve los ID de los usuarios asociados a este cliente.</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a><span class="sd">        Returns:</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="sd">            list: Lista de IDs de usuarios.</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">user</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">]</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ResellerPackage</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;reseller_packages&quot;</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>        <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Clave primaria única del paquete de reseller.&quot;</span><span class="p">,</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>    <span class="p">)</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>    <span class="n">reseller_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;users.id&quot;</span><span class="p">),</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;ID del usuario reseller (UUID).&quot;</span><span class="p">,</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>    <span class="p">)</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>    <span class="n">max_clients</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Número máximo de clientes permitidos en este paquete de reseller.&quot;</span><span class="p">,</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>    <span class="p">)</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>    <span class="n">current_clients</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Total de clientes asignados hasta el momento a ese reseller.&quot;</span><span class="p">,</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>    <span class="p">)</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>    <span class="c1"># Constraint a nivel de base de datos</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">CheckConstraint</span><span class="p">(</span><span class="s2">&quot;current_clients &lt;= max_clients&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;check_client_limit&quot;</span><span class="p">),</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>    <span class="p">)</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="sd">        Verifica si el reseller puede crear más clientes.</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a><span class="sd">        Returns:</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a><span class="sd">            bool: True si puede crear más clientes, False en caso contrario.</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_clients</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_clients</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">increase_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a><span class="sd">        Incrementa el contador de clientes.</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_clients</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decrease_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a><span class="sd">        Decrementa el contador de clientes.</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_clients</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">current_clients</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_available_slots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="sd">        Obtiene el número de espacios disponibles para nuevos clientes.</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">        Returns:</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a><span class="sd">            int: Número de espacios disponibles</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_clients</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_clients</span><span class="p">)</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">assign_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organization</span><span class="p">):</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a><span class="sd">        Asigna un cliente a este reseller si hay espacios disponibles.</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a><span class="sd">        Args:</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a><span class="sd">            client (Client): Cliente a asignar</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a><span class="sd">        Returns:</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a><span class="sd">            bool: True si se asignó correctamente, False en caso contrario</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_client</span><span class="p">():</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>        <span class="n">organization</span><span class="o">.</span><span class="n">reseller_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">increase_client</span><span class="p">()</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unassign_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organizarion</span><span class="p">):</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="sd">        Desasigna un cliente de este reseller.</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="sd">        Args:</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="sd">            client (Client): Cliente a desasignar</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">        Returns:</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="sd">            bool: True si se desasignó correctamente, False en caso contrario</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">reseller_id</span> <span class="o">==</span> <span class="n">organizarion</span><span class="o">.</span><span class="n">reseller_id</span><span class="p">:</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>        <span class="n">organizarion</span><span class="o">.</span><span class="n">reseller_package_id</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">decrease_client</span><span class="p">()</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_users_clients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a><span class="sd">        Obtiene el listado de todos los usuarios que son parte de los clientes de este reseller.</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a><span class="sd">        Returns:</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a><span class="sd">            list: Lista de usuarios asociados a los clientes del reseller.</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>        <span class="n">users</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>        <span class="k">for</span> <span class="n">organization</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">organizations</span><span class="p">:</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>            <span class="n">users</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">organization</span><span class="o">.</span><span class="n">users</span><span class="p">)</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>        <span class="k">return</span> <span class="n">users</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a><span class="c1"># Funciones de utilidad.</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a><span class="c1"># Funciones de utilidad adicionales</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a><span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a><span class="k">def</span><span class="w"> </span><span class="nf">check_permission</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">permission_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">client_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a><span class="sd">    Verifica permisos de forma centralizada y cacheada.</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a><span class="sd">    Args:</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a><span class="sd">        user_id: (int): ID del usuario</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a><span class="sd">        permission_name (str): Nombre del permiso a verificar (ej: &#39;full_management&#39;)</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a><span class="sd">        action_name (str): Nombre de la acción a verificar (ej: &#39;create&#39;)</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a><span class="sd">        client_id (int): ID de la organización (opcional)</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a><span class="sd">    Returns:</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a><span class="sd">        bool: True si el usuario tiene el permiso, False en caso contrario</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>    <span class="k">return</span> <span class="n">user</span><span class="o">.</span><span class="n">has_permission</span><span class="p">(</span><span class="n">permission_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">client_id</span><span class="p">)</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a><span class="k">def</span><span class="w"> </span><span class="nf">verify_user_credentials</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a><span class="sd">    Verifica las credenciales de un usuario de forma segura.</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a><span class="sd">    Args:</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a><span class="sd">        username (str): Nombre de usuario</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a><span class="sd">        password (str): Contraseña en texto plano</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a><span class="sd">    Returns:</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a><span class="sd">        User or None: El usuario si las credenciales son correctas, None en caso contrario</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>    <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">user</span><span class="o">.</span><span class="n">check_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="ow">and</span> <span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>        <span class="k">return</span> <span class="n">user</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>    <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a><span class="k">def</span><span class="w"> </span><span class="nf">verify_user_in_organization</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">org_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a><span class="sd">    Verifica si un usuario pertenece a una organización específica.</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a><span class="sd">    Args:</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a><span class="sd">        user_id (str): ID del usuario (UUID en formato string).</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a><span class="sd">        org_id (int): ID de la organización.</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a><span class="sd">    Returns:</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a><span class="sd">        bool: True si el usuario pertenece a la organización o tiene permisos especiales,</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a><span class="sd">              False en caso contrario.</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>    <span class="c1"># Obtener el usuario por su ID</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># El usuario no existe, retorna False</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>    <span class="c1"># Si el usuario es administrador, tiene acceso implícito a todas las organizaciones</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">is_admin</span><span class="p">():</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>    <span class="c1"># Verificar si el usuario es un reseller y la organización pertenece a su paquete</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">is_reseller</span><span class="p">():</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a>        <span class="c1"># Obtener el paquete del reseller asociado al usuario</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a>        <span class="n">reseller_package</span> <span class="o">=</span> <span class="n">ResellerPackage</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">reseller_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>        <span class="k">if</span> <span class="n">reseller_package</span><span class="p">:</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>            <span class="c1"># Verificar si la organización está en las organizaciones del paquete del reseller</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>            <span class="n">organization</span> <span class="o">=</span> <span class="n">Organization</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>                <span class="nb">id</span><span class="o">=</span><span class="n">org_id</span><span class="p">,</span> <span class="n">reseller_id</span><span class="o">=</span><span class="n">reseller_package</span><span class="o">.</span><span class="n">id</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>            <span class="k">if</span> <span class="n">organization</span><span class="p">:</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>                <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># La organización pertenece al reseller</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>    <span class="c1"># Verificar si el usuario está directamente asociado a la organización</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>    <span class="c1"># Usamos la relación &#39;organizations&#39; del modelo User</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">org</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">org_id</span> <span class="k">for</span> <span class="n">org</span> <span class="ow">in</span> <span class="n">user</span><span class="o">.</span><span class="n">organizations</span><span class="p">)</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_clients_for_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a><span class="sd">    Obtiene el listado de clientes asignados a un usuario específico.</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a><span class="sd">    Args:</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a><span class="sd">        user_id (str): ID del usuario (UUID en formato string).</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a><span class="sd">    Returns:</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a><span class="sd">        list: Lista de organizaciones asignadas al usuario.</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>    <span class="c1"># Obtener el usuario por su ID</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>        <span class="k">return</span> <span class="p">[]</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>    <span class="c1"># Si el usuario es administrador, obtener todas las organizaciones</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">is_admin</span><span class="p">():</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>        <span class="k">return</span> <span class="n">Organization</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>    <span class="c1"># Si el usuario es reseller, obtener las organizaciones asignadas a su paquete</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">is_reseller</span><span class="p">():</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>        <span class="n">reseller_package</span> <span class="o">=</span> <span class="p">(</span><span class="n">ResellerPackage</span><span class="o">.</span><span class="n">query</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>                             <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="n">ResellerPackage</span><span class="o">.</span><span class="n">organizations</span><span class="p">))</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>                             <span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">reseller_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">())</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>        <span class="k">if</span> <span class="n">reseller_package</span><span class="p">:</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>            <span class="k">return</span> <span class="n">reseller_package</span><span class="o">.</span><span class="n">organizations</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>    <span class="c1"># Si el usuario no es administrador ni reseller, obtener las organizaciones a las que está directamente asignado</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">query</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>            <span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>            <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">organizations</span><span class="p">))</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>            <span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">organizations</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="RoleEnum">
                            <input id="RoleEnum-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">RoleEnum</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="RoleEnum-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoleEnum"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoleEnum-42"><a href="#RoleEnum-42"><span class="linenos">42</span></a><span class="k">class</span><span class="w"> </span><span class="nc">RoleEnum</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="RoleEnum-43"><a href="#RoleEnum-43"><span class="linenos">43</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;RoleEnum: Defines the predefined roles within the system</span>
</span><span id="RoleEnum-44"><a href="#RoleEnum-44"><span class="linenos">44</span></a><span class="sd">    (administrator, reseller, organization administrator, organization editor, organization viewer).</span>
</span><span id="RoleEnum-45"><a href="#RoleEnum-45"><span class="linenos">45</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="RoleEnum-46"><a href="#RoleEnum-46"><span class="linenos">46</span></a>
</span><span id="RoleEnum-47"><a href="#RoleEnum-47"><span class="linenos">47</span></a>    <span class="n">ADMINISTRATOR</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;administrator&quot;</span><span class="p">,</span> <span class="s2">&quot;Administrador&quot;</span><span class="p">)</span>
</span><span id="RoleEnum-48"><a href="#RoleEnum-48"><span class="linenos">48</span></a>    <span class="n">RESELLER</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;reseller&quot;</span><span class="p">,</span> <span class="s2">&quot;Revendedor&quot;</span><span class="p">)</span>
</span><span id="RoleEnum-49"><a href="#RoleEnum-49"><span class="linenos">49</span></a>    <span class="n">ORG_ADMIN</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;org_admin&quot;</span><span class="p">,</span> <span class="s2">&quot;Administrador de Organización&quot;</span><span class="p">)</span>
</span><span id="RoleEnum-50"><a href="#RoleEnum-50"><span class="linenos">50</span></a>    <span class="n">ORG_EDITOR</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;org_editor&quot;</span><span class="p">,</span> <span class="s2">&quot;Editor de Organización&quot;</span><span class="p">)</span>
</span><span id="RoleEnum-51"><a href="#RoleEnum-51"><span class="linenos">51</span></a>    <span class="n">ORG_VIEWER</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;org_viewer&quot;</span><span class="p">,</span> <span class="s2">&quot;Visor de Organización&quot;</span><span class="p">)</span>
</span><span id="RoleEnum-52"><a href="#RoleEnum-52"><span class="linenos">52</span></a>
</span><span id="RoleEnum-53"><a href="#RoleEnum-53"><span class="linenos">53</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
</span><span id="RoleEnum-54"><a href="#RoleEnum-54"><span class="linenos">54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
</span><span id="RoleEnum-55"><a href="#RoleEnum-55"><span class="linenos">55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
</span><span id="RoleEnum-56"><a href="#RoleEnum-56"><span class="linenos">56</span></a>
</span><span id="RoleEnum-57"><a href="#RoleEnum-57"><span class="linenos">57</span></a>    <span class="nd">@property</span>
</span><span id="RoleEnum-58"><a href="#RoleEnum-58"><span class="linenos">58</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="RoleEnum-59"><a href="#RoleEnum-59"><span class="linenos">59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoleEnum-60"><a href="#RoleEnum-60"><span class="linenos">60</span></a><span class="sd">        Devuelve el valor del rol.</span>
</span><span id="RoleEnum-61"><a href="#RoleEnum-61"><span class="linenos">61</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoleEnum-62"><a href="#RoleEnum-62"><span class="linenos">62</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
</span></pre></div>


            <div class="docstring"><p>RoleEnum: Defines the predefined roles within the system
(administrator, reseller, organization administrator, organization editor, organization viewer).</p>
</div>


                            <div id="RoleEnum.ADMINISTRATOR" class="classattr">
                                <div class="attr variable">
            <span class="name">ADMINISTRATOR</span>        =
<span class="default_value">&lt;<a href="#RoleEnum.ADMINISTRATOR">RoleEnum.ADMINISTRATOR</a>: (&#39;administrator&#39;, &#39;Administrador&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#RoleEnum.ADMINISTRATOR"></a>
    
    

                            </div>
                            <div id="RoleEnum.RESELLER" class="classattr">
                                <div class="attr variable">
            <span class="name">RESELLER</span>        =
<span class="default_value">&lt;<a href="#RoleEnum.RESELLER">RoleEnum.RESELLER</a>: (&#39;reseller&#39;, &#39;Revendedor&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#RoleEnum.RESELLER"></a>
    
    

                            </div>
                            <div id="RoleEnum.ORG_ADMIN" class="classattr">
                                <div class="attr variable">
            <span class="name">ORG_ADMIN</span>        =
<span class="default_value">&lt;<a href="#RoleEnum.ORG_ADMIN">RoleEnum.ORG_ADMIN</a>: (&#39;org_admin&#39;, &#39;Administrador de Organización&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#RoleEnum.ORG_ADMIN"></a>
    
    

                            </div>
                            <div id="RoleEnum.ORG_EDITOR" class="classattr">
                                <div class="attr variable">
            <span class="name">ORG_EDITOR</span>        =
<span class="default_value">&lt;<a href="#RoleEnum.ORG_EDITOR">RoleEnum.ORG_EDITOR</a>: (&#39;org_editor&#39;, &#39;Editor de Organización&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#RoleEnum.ORG_EDITOR"></a>
    
    

                            </div>
                            <div id="RoleEnum.ORG_VIEWER" class="classattr">
                                <div class="attr variable">
            <span class="name">ORG_VIEWER</span>        =
<span class="default_value">&lt;<a href="#RoleEnum.ORG_VIEWER">RoleEnum.ORG_VIEWER</a>: (&#39;org_viewer&#39;, &#39;Visor de Organización&#39;)&gt;</span>

        
    </div>
    <a class="headerlink" href="#RoleEnum.ORG_VIEWER"></a>
    
    

                            </div>
                            <div id="RoleEnum.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span>

        
    </div>
    <a class="headerlink" href="#RoleEnum.id"></a>
    
    

                            </div>
                            <div id="RoleEnum.description" class="classattr">
                                <div class="attr variable">
            <span class="name">description</span>

        
    </div>
    <a class="headerlink" href="#RoleEnum.description"></a>
    
    

                            </div>
                            <div id="RoleEnum.value" class="classattr">
                                        <input id="RoleEnum.value-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">value</span>

                <label class="view-source-button" for="RoleEnum.value-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RoleEnum.value"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RoleEnum.value-57"><a href="#RoleEnum.value-57"><span class="linenos">57</span></a>    <span class="nd">@property</span>
</span><span id="RoleEnum.value-58"><a href="#RoleEnum.value-58"><span class="linenos">58</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="RoleEnum.value-59"><a href="#RoleEnum.value-59"><span class="linenos">59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RoleEnum.value-60"><a href="#RoleEnum.value-60"><span class="linenos">60</span></a><span class="sd">        Devuelve el valor del rol.</span>
</span><span id="RoleEnum.value-61"><a href="#RoleEnum.value-61"><span class="linenos">61</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RoleEnum.value-62"><a href="#RoleEnum.value-62"><span class="linenos">62</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
</span></pre></div>


            <div class="docstring"><p>Devuelve el valor del rol.</p>
</div>


                            </div>
                </section>
                <section id="ActionEnum">
                            <input id="ActionEnum-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ActionEnum</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="ActionEnum-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ActionEnum"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ActionEnum-65"><a href="#ActionEnum-65"><span class="linenos">65</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ActionEnum</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="ActionEnum-66"><a href="#ActionEnum-66"><span class="linenos">66</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;ActionEnum: Define las acciones posibles</span>
</span><span id="ActionEnum-67"><a href="#ActionEnum-67"><span class="linenos">67</span></a><span class="sd">    (crear, leer, actualizar, eliminar, administrar).&quot;&quot;&quot;</span>
</span><span id="ActionEnum-68"><a href="#ActionEnum-68"><span class="linenos">68</span></a>
</span><span id="ActionEnum-69"><a href="#ActionEnum-69"><span class="linenos">69</span></a>    <span class="n">CREATE</span> <span class="o">=</span> <span class="s2">&quot;create&quot;</span>
</span><span id="ActionEnum-70"><a href="#ActionEnum-70"><span class="linenos">70</span></a>    <span class="n">READ</span> <span class="o">=</span> <span class="s2">&quot;read&quot;</span>
</span><span id="ActionEnum-71"><a href="#ActionEnum-71"><span class="linenos">71</span></a>    <span class="n">UPDATE</span> <span class="o">=</span> <span class="s2">&quot;update&quot;</span>
</span><span id="ActionEnum-72"><a href="#ActionEnum-72"><span class="linenos">72</span></a>    <span class="n">DELETE</span> <span class="o">=</span> <span class="s2">&quot;delete&quot;</span>
</span><span id="ActionEnum-73"><a href="#ActionEnum-73"><span class="linenos">73</span></a>    <span class="n">MANAGE</span> <span class="o">=</span> <span class="s2">&quot;manage&quot;</span>
</span></pre></div>


            <div class="docstring"><p>ActionEnum: Define las acciones posibles
(crear, leer, actualizar, eliminar, administrar).</p>
</div>


                            <div id="ActionEnum.CREATE" class="classattr">
                                <div class="attr variable">
            <span class="name">CREATE</span>        =
<span class="default_value">&lt;<a href="#ActionEnum.CREATE">ActionEnum.CREATE</a>: &#39;create&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ActionEnum.CREATE"></a>
    
    

                            </div>
                            <div id="ActionEnum.READ" class="classattr">
                                <div class="attr variable">
            <span class="name">READ</span>        =
<span class="default_value">&lt;<a href="#ActionEnum.READ">ActionEnum.READ</a>: &#39;read&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ActionEnum.READ"></a>
    
    

                            </div>
                            <div id="ActionEnum.UPDATE" class="classattr">
                                <div class="attr variable">
            <span class="name">UPDATE</span>        =
<span class="default_value">&lt;<a href="#ActionEnum.UPDATE">ActionEnum.UPDATE</a>: &#39;update&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ActionEnum.UPDATE"></a>
    
    

                            </div>
                            <div id="ActionEnum.DELETE" class="classattr">
                                <div class="attr variable">
            <span class="name">DELETE</span>        =
<span class="default_value">&lt;<a href="#ActionEnum.DELETE">ActionEnum.DELETE</a>: &#39;delete&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ActionEnum.DELETE"></a>
    
    

                            </div>
                            <div id="ActionEnum.MANAGE" class="classattr">
                                <div class="attr variable">
            <span class="name">MANAGE</span>        =
<span class="default_value">&lt;<a href="#ActionEnum.MANAGE">ActionEnum.MANAGE</a>: &#39;manage&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ActionEnum.MANAGE"></a>
    
    

                            </div>
                </section>
                <section id="PermissionEnum">
                            <input id="PermissionEnum-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PermissionEnum</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="PermissionEnum-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PermissionEnum"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PermissionEnum-76"><a href="#PermissionEnum-76"><span class="linenos">76</span></a><span class="k">class</span><span class="w"> </span><span class="nc">PermissionEnum</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="PermissionEnum-77"><a href="#PermissionEnum-77"><span class="linenos">77</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;PermissionEnum: Define los permisos disponibles</span>
</span><span id="PermissionEnum-78"><a href="#PermissionEnum-78"><span class="linenos">78</span></a><span class="sd">    (gestión completa, gestión de organización, gestión de contenido, informes, ajustes del sistema, informes limitados).</span>
</span><span id="PermissionEnum-79"><a href="#PermissionEnum-79"><span class="linenos">79</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="PermissionEnum-80"><a href="#PermissionEnum-80"><span class="linenos">80</span></a>
</span><span id="PermissionEnum-81"><a href="#PermissionEnum-81"><span class="linenos">81</span></a>    <span class="n">FULL_MANAGEMENT</span> <span class="o">=</span> <span class="s2">&quot;full_management&quot;</span>
</span><span id="PermissionEnum-82"><a href="#PermissionEnum-82"><span class="linenos">82</span></a>    <span class="n">ORG_MANAGEMENT</span> <span class="o">=</span> <span class="s2">&quot;org_management&quot;</span>
</span><span id="PermissionEnum-83"><a href="#PermissionEnum-83"><span class="linenos">83</span></a>    <span class="n">CONTENT_MANAGEMENT</span> <span class="o">=</span> <span class="s2">&quot;content_management&quot;</span>
</span><span id="PermissionEnum-84"><a href="#PermissionEnum-84"><span class="linenos">84</span></a>    <span class="n">REPORTING</span> <span class="o">=</span> <span class="s2">&quot;reporting&quot;</span>
</span><span id="PermissionEnum-85"><a href="#PermissionEnum-85"><span class="linenos">85</span></a>    <span class="n">SYSTEM_SETTINGS</span> <span class="o">=</span> <span class="s2">&quot;system_settings&quot;</span>
</span><span id="PermissionEnum-86"><a href="#PermissionEnum-86"><span class="linenos">86</span></a>    <span class="n">LIMITED_REPORTS</span> <span class="o">=</span> <span class="s2">&quot;limited_reports&quot;</span>
</span></pre></div>


            <div class="docstring"><p>PermissionEnum: Define los permisos disponibles
(gestión completa, gestión de organización, gestión de contenido, informes, ajustes del sistema, informes limitados).</p>
</div>


                            <div id="PermissionEnum.FULL_MANAGEMENT" class="classattr">
                                <div class="attr variable">
            <span class="name">FULL_MANAGEMENT</span>        =
<span class="default_value">&lt;<a href="#PermissionEnum.FULL_MANAGEMENT">PermissionEnum.FULL_MANAGEMENT</a>: &#39;full_management&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#PermissionEnum.FULL_MANAGEMENT"></a>
    
    

                            </div>
                            <div id="PermissionEnum.ORG_MANAGEMENT" class="classattr">
                                <div class="attr variable">
            <span class="name">ORG_MANAGEMENT</span>        =
<span class="default_value">&lt;<a href="#PermissionEnum.ORG_MANAGEMENT">PermissionEnum.ORG_MANAGEMENT</a>: &#39;org_management&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#PermissionEnum.ORG_MANAGEMENT"></a>
    
    

                            </div>
                            <div id="PermissionEnum.CONTENT_MANAGEMENT" class="classattr">
                                <div class="attr variable">
            <span class="name">CONTENT_MANAGEMENT</span>        =
<span class="default_value">&lt;<a href="#PermissionEnum.CONTENT_MANAGEMENT">PermissionEnum.CONTENT_MANAGEMENT</a>: &#39;content_management&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#PermissionEnum.CONTENT_MANAGEMENT"></a>
    
    

                            </div>
                            <div id="PermissionEnum.REPORTING" class="classattr">
                                <div class="attr variable">
            <span class="name">REPORTING</span>        =
<span class="default_value">&lt;<a href="#PermissionEnum.REPORTING">PermissionEnum.REPORTING</a>: &#39;reporting&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#PermissionEnum.REPORTING"></a>
    
    

                            </div>
                            <div id="PermissionEnum.SYSTEM_SETTINGS" class="classattr">
                                <div class="attr variable">
            <span class="name">SYSTEM_SETTINGS</span>        =
<span class="default_value">&lt;<a href="#PermissionEnum.SYSTEM_SETTINGS">PermissionEnum.SYSTEM_SETTINGS</a>: &#39;system_settings&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#PermissionEnum.SYSTEM_SETTINGS"></a>
    
    

                            </div>
                            <div id="PermissionEnum.LIMITED_REPORTS" class="classattr">
                                <div class="attr variable">
            <span class="name">LIMITED_REPORTS</span>        =
<span class="default_value">&lt;<a href="#PermissionEnum.LIMITED_REPORTS">PermissionEnum.LIMITED_REPORTS</a>: &#39;limited_reports&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#PermissionEnum.LIMITED_REPORTS"></a>
    
    

                            </div>
                </section>
                <section id="ROLE_PERMISSIONS">
                    <div class="attr variable">
            <span class="name">ROLE_PERMISSIONS</span>        =
<input id="ROLE_PERMISSIONS-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="ROLE_PERMISSIONS-view-value"></label><span class="default_value">{&lt;<a href="#RoleEnum.ADMINISTRATOR">RoleEnum.ADMINISTRATOR</a>: (&#39;administrator&#39;, &#39;Administrador&#39;)&gt;: [&lt;<a href="#PermissionEnum.FULL_MANAGEMENT">PermissionEnum.FULL_MANAGEMENT</a>: &#39;full_management&#39;&gt;], &lt;<a href="#RoleEnum.RESELLER">RoleEnum.RESELLER</a>: (&#39;reseller&#39;, &#39;Revendedor&#39;)&gt;: [&lt;<a href="#PermissionEnum.ORG_MANAGEMENT">PermissionEnum.ORG_MANAGEMENT</a>: &#39;org_management&#39;&gt;], &lt;<a href="#RoleEnum.ORG_ADMIN">RoleEnum.ORG_ADMIN</a>: (&#39;org_admin&#39;, &#39;Administrador de Organización&#39;)&gt;: [&lt;<a href="#PermissionEnum.CONTENT_MANAGEMENT">PermissionEnum.CONTENT_MANAGEMENT</a>: &#39;content_management&#39;&gt;, &lt;<a href="#PermissionEnum.REPORTING">PermissionEnum.REPORTING</a>: &#39;reporting&#39;&gt;], &lt;<a href="#RoleEnum.ORG_EDITOR">RoleEnum.ORG_EDITOR</a>: (&#39;org_editor&#39;, &#39;Editor de Organización&#39;)&gt;: [&lt;<a href="#PermissionEnum.REPORTING">PermissionEnum.REPORTING</a>: &#39;reporting&#39;&gt;], &lt;<a href="#RoleEnum.ORG_VIEWER">RoleEnum.ORG_VIEWER</a>: (&#39;org_viewer&#39;, &#39;Visor de Organización&#39;)&gt;: [&lt;<a href="#PermissionEnum.REPORTING">PermissionEnum.REPORTING</a>: &#39;reporting&#39;&gt;]}</span>

        
    </div>
    <a class="headerlink" href="#ROLE_PERMISSIONS"></a>
    
    

                </section>
                <section id="PERMISSION_ACTIONS">
                    <div class="attr variable">
            <span class="name">PERMISSION_ACTIONS</span>        =
<input id="PERMISSION_ACTIONS-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="PERMISSION_ACTIONS-view-value"></label><span class="default_value">{&lt;<a href="#PermissionEnum.FULL_MANAGEMENT">PermissionEnum.FULL_MANAGEMENT</a>: &#39;full_management&#39;&gt;: [&lt;<a href="#ActionEnum.CREATE">ActionEnum.CREATE</a>: &#39;create&#39;&gt;, &lt;<a href="#ActionEnum.READ">ActionEnum.READ</a>: &#39;read&#39;&gt;, &lt;<a href="#ActionEnum.UPDATE">ActionEnum.UPDATE</a>: &#39;update&#39;&gt;, &lt;<a href="#ActionEnum.DELETE">ActionEnum.DELETE</a>: &#39;delete&#39;&gt;, &lt;<a href="#ActionEnum.MANAGE">ActionEnum.MANAGE</a>: &#39;manage&#39;&gt;], &lt;<a href="#PermissionEnum.ORG_MANAGEMENT">PermissionEnum.ORG_MANAGEMENT</a>: &#39;org_management&#39;&gt;: [&lt;<a href="#ActionEnum.CREATE">ActionEnum.CREATE</a>: &#39;create&#39;&gt;, &lt;<a href="#ActionEnum.READ">ActionEnum.READ</a>: &#39;read&#39;&gt;, &lt;<a href="#ActionEnum.UPDATE">ActionEnum.UPDATE</a>: &#39;update&#39;&gt;, &lt;<a href="#ActionEnum.DELETE">ActionEnum.DELETE</a>: &#39;delete&#39;&gt;], &lt;<a href="#PermissionEnum.CONTENT_MANAGEMENT">PermissionEnum.CONTENT_MANAGEMENT</a>: &#39;content_management&#39;&gt;: [&lt;<a href="#ActionEnum.CREATE">ActionEnum.CREATE</a>: &#39;create&#39;&gt;, &lt;<a href="#ActionEnum.READ">ActionEnum.READ</a>: &#39;read&#39;&gt;, &lt;<a href="#ActionEnum.UPDATE">ActionEnum.UPDATE</a>: &#39;update&#39;&gt;], &lt;<a href="#PermissionEnum.REPORTING">PermissionEnum.REPORTING</a>: &#39;reporting&#39;&gt;: [&lt;<a href="#ActionEnum.READ">ActionEnum.READ</a>: &#39;read&#39;&gt;]}</span>

        
    </div>
    <a class="headerlink" href="#PERMISSION_ACTIONS"></a>
    
    

                </section>
                <section id="user_organization">
                    <div class="attr variable">
            <span class="name">user_organization</span>        =
<input id="user_organization-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="user_organization-view-value"></label><span class="default_value">Table(&#39;user_organization&#39;, MetaData(), Column(&#39;user_id&#39;, String(length=36), ForeignKey(&#39;users.id&#39;), table=&lt;user_organization&gt;, primary_key=True, nullable=False), Column(&#39;organization_id&#39;, Integer(), ForeignKey(&#39;organizations.id&#39;), table=&lt;user_organization&gt;, primary_key=True, nullable=False), schema=None)</span>

        
    </div>
    <a class="headerlink" href="#user_organization"></a>
    
    

                </section>
                <section id="short_uuid">
                            <input id="short_uuid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">short_uuid</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="short_uuid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#short_uuid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="short_uuid-129"><a href="#short_uuid-129"><span class="linenos">129</span></a><span class="k">def</span><span class="w"> </span><span class="nf">short_uuid</span><span class="p">():</span>
</span><span id="short_uuid-130"><a href="#short_uuid-130"><span class="linenos">130</span></a>    <span class="k">return</span> <span class="nb">hex</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">int</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>  <span class="c1"># 8 caracteres hexadecimales</span>
</span></pre></div>


    

                </section>
                <section id="User">
                            <input id="User-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">User</span><wbr>(<span class="base">sqlalchemy.orm.decl_api._DynamicAttributesType</span>, <span class="base">sqlalchemy.inspection.Inspectable[sqlalchemy.orm.mapper.Mapper[typing.Any]]</span>):

                <label class="view-source-button" for="User-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#User"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="User-133"><a href="#User-133"><span class="linenos">133</span></a><span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="User-134"><a href="#User-134"><span class="linenos">134</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Modelo que representa a los usuarios del sistema.</span>
</span><span id="User-135"><a href="#User-135"><span class="linenos">135</span></a><span class="sd">    Gestiona la información personal, credenciales de acceso, roles,</span>
</span><span id="User-136"><a href="#User-136"><span class="linenos">136</span></a><span class="sd">    y la pertenencia a organizaciones (clientes).</span>
</span><span id="User-137"><a href="#User-137"><span class="linenos">137</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="User-138"><a href="#User-138"><span class="linenos">138</span></a>
</span><span id="User-139"><a href="#User-139"><span class="linenos">139</span></a>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;users&quot;</span>
</span><span id="User-140"><a href="#User-140"><span class="linenos">140</span></a>    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="User-141"><a href="#User-141"><span class="linenos">141</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
</span><span id="User-142"><a href="#User-142"><span class="linenos">142</span></a>        <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="User-143"><a href="#User-143"><span class="linenos">143</span></a>        <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="User-144"><a href="#User-144"><span class="linenos">144</span></a>        <span class="n">default</span><span class="o">=</span><span class="n">short_uuid</span><span class="p">,</span>
</span><span id="User-145"><a href="#User-145"><span class="linenos">145</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Clave primaria única del usuario en formato UUID.&quot;</span><span class="p">,</span>
</span><span id="User-146"><a href="#User-146"><span class="linenos">146</span></a>    <span class="p">)</span>
</span><span id="User-147"><a href="#User-147"><span class="linenos">147</span></a>    <span class="n">username</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="User-148"><a href="#User-148"><span class="linenos">148</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">80</span><span class="p">),</span>
</span><span id="User-149"><a href="#User-149"><span class="linenos">149</span></a>        <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="User-150"><a href="#User-150"><span class="linenos">150</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="User-151"><a href="#User-151"><span class="linenos">151</span></a>        <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="User-152"><a href="#User-152"><span class="linenos">152</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Nombre de usuario (String, único, no nulo, indexado). Utilizado para el login.&quot;</span><span class="p">,</span>
</span><span id="User-153"><a href="#User-153"><span class="linenos">153</span></a>    <span class="p">)</span>
</span><span id="User-154"><a href="#User-154"><span class="linenos">154</span></a>    <span class="n">email</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="User-155"><a href="#User-155"><span class="linenos">155</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">120</span><span class="p">),</span>
</span><span id="User-156"><a href="#User-156"><span class="linenos">156</span></a>        <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="User-157"><a href="#User-157"><span class="linenos">157</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="User-158"><a href="#User-158"><span class="linenos">158</span></a>        <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="User-159"><a href="#User-159"><span class="linenos">159</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Dirección de correo electrónico (String, único, no nulo, indexado).&quot;</span><span class="p">,</span>
</span><span id="User-160"><a href="#User-160"><span class="linenos">160</span></a>    <span class="p">)</span>
</span><span id="User-161"><a href="#User-161"><span class="linenos">161</span></a>    <span class="n">full_name</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="User-162"><a href="#User-162"><span class="linenos">162</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">128</span><span class="p">),</span>
</span><span id="User-163"><a href="#User-163"><span class="linenos">163</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="User-164"><a href="#User-164"><span class="linenos">164</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Nombre completo del usuario (String, no nulo).&quot;</span><span class="p">,</span>
</span><span id="User-165"><a href="#User-165"><span class="linenos">165</span></a>    <span class="p">)</span>
</span><span id="User-166"><a href="#User-166"><span class="linenos">166</span></a>    <span class="n">password_hash</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="User-167"><a href="#User-167"><span class="linenos">167</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
</span><span id="User-168"><a href="#User-168"><span class="linenos">168</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="User-169"><a href="#User-169"><span class="linenos">169</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Hash de la contraseña (String). Almacena la contraseña de forma segura.&quot;</span><span class="p">,</span>
</span><span id="User-170"><a href="#User-170"><span class="linenos">170</span></a>    <span class="p">)</span>
</span><span id="User-171"><a href="#User-171"><span class="linenos">171</span></a>    <span class="n">profile_data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="User-172"><a href="#User-172"><span class="linenos">172</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">JSON</span><span class="p">,</span>
</span><span id="User-173"><a href="#User-173"><span class="linenos">173</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="User-174"><a href="#User-174"><span class="linenos">174</span></a>        <span class="n">default</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
</span><span id="User-175"><a href="#User-175"><span class="linenos">175</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Datos adicionales del perfil (JSON, valor por defecto: diccionario vacío). Permite almacenar información extra específica del usuario.&quot;</span><span class="p">,</span>
</span><span id="User-176"><a href="#User-176"><span class="linenos">176</span></a>    <span class="p">)</span>
</span><span id="User-177"><a href="#User-177"><span class="linenos">177</span></a>    <span class="n">created_at</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="User-178"><a href="#User-178"><span class="linenos">178</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">DateTime</span><span class="p">,</span>
</span><span id="User-179"><a href="#User-179"><span class="linenos">179</span></a>        <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">,</span>
</span><span id="User-180"><a href="#User-180"><span class="linenos">180</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Fecha de creación del usuario (DateTime).&quot;</span><span class="p">,</span>
</span><span id="User-181"><a href="#User-181"><span class="linenos">181</span></a>    <span class="p">)</span>
</span><span id="User-182"><a href="#User-182"><span class="linenos">182</span></a>    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="User-183"><a href="#User-183"><span class="linenos">183</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">DateTime</span><span class="p">,</span>
</span><span id="User-184"><a href="#User-184"><span class="linenos">184</span></a>        <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">,</span>
</span><span id="User-185"><a href="#User-185"><span class="linenos">185</span></a>        <span class="n">onupdate</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">,</span>
</span><span id="User-186"><a href="#User-186"><span class="linenos">186</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Fecha de última actualización del usuario (DateTime). Se actualiza automáticamente.&quot;</span><span class="p">,</span>
</span><span id="User-187"><a href="#User-187"><span class="linenos">187</span></a>    <span class="p">)</span>
</span><span id="User-188"><a href="#User-188"><span class="linenos">188</span></a>    <span class="n">active</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="User-189"><a href="#User-189"><span class="linenos">189</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">Boolean</span><span class="p">,</span>
</span><span id="User-190"><a href="#User-190"><span class="linenos">190</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="User-191"><a href="#User-191"><span class="linenos">191</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Estado de la cuenta (Boolean, valor por defecto: True). Indica si la cuenta está activa o inactiva.&quot;</span><span class="p">,</span>
</span><span id="User-192"><a href="#User-192"><span class="linenos">192</span></a>    <span class="p">)</span>
</span><span id="User-193"><a href="#User-193"><span class="linenos">193</span></a>    <span class="n">role</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="User-194"><a href="#User-194"><span class="linenos">194</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="n">RoleEnum</span><span class="p">),</span>
</span><span id="User-195"><a href="#User-195"><span class="linenos">195</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="User-196"><a href="#User-196"><span class="linenos">196</span></a>        <span class="n">default</span><span class="o">=</span><span class="n">RoleEnum</span><span class="o">.</span><span class="n">ORG_VIEWER</span><span class="p">,</span>
</span><span id="User-197"><a href="#User-197"><span class="linenos">197</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Rol del usuario (Enum, no nulo, valor por defecto: ORG_VIEWER). Define el rol del usuario en el sistema.&quot;</span><span class="p">,</span>
</span><span id="User-198"><a href="#User-198"><span class="linenos">198</span></a>    <span class="p">)</span>
</span><span id="User-199"><a href="#User-199"><span class="linenos">199</span></a>    <span class="c1"># Relaciones</span>
</span><span id="User-200"><a href="#User-200"><span class="linenos">200</span></a>    <span class="n">reseller_packages</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span>
</span><span id="User-201"><a href="#User-201"><span class="linenos">201</span></a>        <span class="s2">&quot;ResellerPackage&quot;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;reseller&quot;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="s2">&quot;dynamic&quot;</span>
</span><span id="User-202"><a href="#User-202"><span class="linenos">202</span></a>    <span class="p">)</span>
</span><span id="User-203"><a href="#User-203"><span class="linenos">203</span></a>
</span><span id="User-204"><a href="#User-204"><span class="linenos">204</span></a>    <span class="n">organizations</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span>
</span><span id="User-205"><a href="#User-205"><span class="linenos">205</span></a>        <span class="s2">&quot;Organization&quot;</span><span class="p">,</span> <span class="n">secondary</span><span class="o">=</span><span class="n">user_organization</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;users&quot;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="s2">&quot;dynamic&quot;</span>
</span><span id="User-206"><a href="#User-206"><span class="linenos">206</span></a>    <span class="p">)</span>
</span><span id="User-207"><a href="#User-207"><span class="linenos">207</span></a>
</span><span id="User-208"><a href="#User-208"><span class="linenos">208</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="User-209"><a href="#User-209"><span class="linenos">209</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Representación en cadena del objeto User.</span>
</span><span id="User-210"><a href="#User-210"><span class="linenos">210</span></a><span class="sd">        Returns:</span>
</span><span id="User-211"><a href="#User-211"><span class="linenos">211</span></a><span class="sd">            str: Representación en cadena del usuario.</span>
</span><span id="User-212"><a href="#User-212"><span class="linenos">212</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User-213"><a href="#User-213"><span class="linenos">213</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;User </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
</span><span id="User-214"><a href="#User-214"><span class="linenos">214</span></a>
</span><span id="User-215"><a href="#User-215"><span class="linenos">215</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
</span><span id="User-216"><a href="#User-216"><span class="linenos">216</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User-217"><a href="#User-217"><span class="linenos">217</span></a><span class="sd">        Establece un hash seguro para la contraseña del usuario.</span>
</span><span id="User-218"><a href="#User-218"><span class="linenos">218</span></a><span class="sd">        Args:</span>
</span><span id="User-219"><a href="#User-219"><span class="linenos">219</span></a><span class="sd">            password (str): La contraseña en texto plano.</span>
</span><span id="User-220"><a href="#User-220"><span class="linenos">220</span></a><span class="sd">        Raises:</span>
</span><span id="User-221"><a href="#User-221"><span class="linenos">221</span></a><span class="sd">            ValueError: Si la contraseña no cumple con los requisitos de seguridad.</span>
</span><span id="User-222"><a href="#User-222"><span class="linenos">222</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User-223"><a href="#User-223"><span class="linenos">223</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">password_hash</span> <span class="o">=</span> <span class="n">generate_password_hash</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
</span><span id="User-224"><a href="#User-224"><span class="linenos">224</span></a>
</span><span id="User-225"><a href="#User-225"><span class="linenos">225</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
</span><span id="User-226"><a href="#User-226"><span class="linenos">226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User-227"><a href="#User-227"><span class="linenos">227</span></a><span class="sd">        Verifica si la contraseña proporcionada coincide con el hash almacenado.</span>
</span><span id="User-228"><a href="#User-228"><span class="linenos">228</span></a><span class="sd">        Args:</span>
</span><span id="User-229"><a href="#User-229"><span class="linenos">229</span></a><span class="sd">            password (str): La contraseña en texto plano a verificar.</span>
</span><span id="User-230"><a href="#User-230"><span class="linenos">230</span></a><span class="sd">        Returns:</span>
</span><span id="User-231"><a href="#User-231"><span class="linenos">231</span></a><span class="sd">            bool: True si la contraseña coincide, False en caso contrario.</span>
</span><span id="User-232"><a href="#User-232"><span class="linenos">232</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User-233"><a href="#User-233"><span class="linenos">233</span></a>        <span class="k">return</span> <span class="n">check_password_hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">password_hash</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
</span><span id="User-234"><a href="#User-234"><span class="linenos">234</span></a>
</span><span id="User-235"><a href="#User-235"><span class="linenos">235</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">has_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">permission_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">client_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="User-236"><a href="#User-236"><span class="linenos">236</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User-237"><a href="#User-237"><span class="linenos">237</span></a><span class="sd">        Verifica si el usuario tiene un permiso específico y opcionalmente dentro de un cliente específico.</span>
</span><span id="User-238"><a href="#User-238"><span class="linenos">238</span></a><span class="sd">        Args:</span>
</span><span id="User-239"><a href="#User-239"><span class="linenos">239</span></a><span class="sd">            permission_name (str): Nombre del permiso a verificar (ej: &#39;full_management&#39;).</span>
</span><span id="User-240"><a href="#User-240"><span class="linenos">240</span></a><span class="sd">            action_name (str): Nombre de la acción a verificar (ej: &#39;create&#39;).</span>
</span><span id="User-241"><a href="#User-241"><span class="linenos">241</span></a><span class="sd">            client_id (int, optional): ID del cliente para verificar el permiso dentro de ese cliente. Defaults to None.</span>
</span><span id="User-242"><a href="#User-242"><span class="linenos">242</span></a><span class="sd">        Returns:</span>
</span><span id="User-243"><a href="#User-243"><span class="linenos">243</span></a><span class="sd">            bool: True si el usuario tiene el permiso y la acción especificados, False en caso contrario.</span>
</span><span id="User-244"><a href="#User-244"><span class="linenos">244</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User-245"><a href="#User-245"><span class="linenos">245</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="User-246"><a href="#User-246"><span class="linenos">246</span></a>            <span class="n">perm_enum</span> <span class="o">=</span> <span class="n">PermissionEnum</span><span class="p">(</span><span class="n">permission_name</span><span class="p">)</span>
</span><span id="User-247"><a href="#User-247"><span class="linenos">247</span></a>            <span class="n">action_enum</span> <span class="o">=</span> <span class="n">ActionEnum</span><span class="p">(</span><span class="n">action_name</span><span class="p">)</span>
</span><span id="User-248"><a href="#User-248"><span class="linenos">248</span></a>
</span><span id="User-249"><a href="#User-249"><span class="linenos">249</span></a>            <span class="c1"># Verificar si el permiso está asignado al rol del usuario</span>
</span><span id="User-250"><a href="#User-250"><span class="linenos">250</span></a>            <span class="k">if</span> <span class="n">perm_enum</span> <span class="ow">in</span> <span class="n">ROLE_PERMISSIONS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">role</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="User-251"><a href="#User-251"><span class="linenos">251</span></a>                <span class="c1"># Verificar si la acción está permitida para ese permiso</span>
</span><span id="User-252"><a href="#User-252"><span class="linenos">252</span></a>                <span class="k">if</span> <span class="n">action_enum</span> <span class="ow">in</span> <span class="n">PERMISSION_ACTIONS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perm_enum</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="User-253"><a href="#User-253"><span class="linenos">253</span></a>                    <span class="k">if</span> <span class="n">client_id</span><span class="p">:</span>
</span><span id="User-254"><a href="#User-254"><span class="linenos">254</span></a>                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span> <span class="o">==</span> <span class="n">client_id</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_admin</span><span class="p">()</span>
</span><span id="User-255"><a href="#User-255"><span class="linenos">255</span></a>                    <span class="k">return</span> <span class="kc">True</span>
</span><span id="User-256"><a href="#User-256"><span class="linenos">256</span></a>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="User-257"><a href="#User-257"><span class="linenos">257</span></a>            <span class="c1"># Si alguno de los valores no está en las enumeraciones, retornar False</span>
</span><span id="User-258"><a href="#User-258"><span class="linenos">258</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="User-259"><a href="#User-259"><span class="linenos">259</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="User-260"><a href="#User-260"><span class="linenos">260</span></a>
</span><span id="User-261"><a href="#User-261"><span class="linenos">261</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_admin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="User-262"><a href="#User-262"><span class="linenos">262</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User-263"><a href="#User-263"><span class="linenos">263</span></a><span class="sd">        Verifica si el usuario tiene el rol de administrador.</span>
</span><span id="User-264"><a href="#User-264"><span class="linenos">264</span></a><span class="sd">        Returns:</span>
</span><span id="User-265"><a href="#User-265"><span class="linenos">265</span></a><span class="sd">            bool: True si el usuario tiene el rol de administrador, False en caso contrario.</span>
</span><span id="User-266"><a href="#User-266"><span class="linenos">266</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User-267"><a href="#User-267"><span class="linenos">267</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="n">RoleEnum</span><span class="o">.</span><span class="n">ADMINISTRATOR</span>
</span><span id="User-268"><a href="#User-268"><span class="linenos">268</span></a>
</span><span id="User-269"><a href="#User-269"><span class="linenos">269</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_reseller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="User-270"><a href="#User-270"><span class="linenos">270</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User-271"><a href="#User-271"><span class="linenos">271</span></a><span class="sd">        Verifica si el usuario tiene el rol de reseller.</span>
</span><span id="User-272"><a href="#User-272"><span class="linenos">272</span></a><span class="sd">        Returns:</span>
</span><span id="User-273"><a href="#User-273"><span class="linenos">273</span></a><span class="sd">            bool: True si el usuario tiene el rol de reseller, False en caso contrario.</span>
</span><span id="User-274"><a href="#User-274"><span class="linenos">274</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User-275"><a href="#User-275"><span class="linenos">275</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="n">RoleEnum</span><span class="o">.</span><span class="n">RESELLER</span>
</span><span id="User-276"><a href="#User-276"><span class="linenos">276</span></a>
</span><span id="User-277"><a href="#User-277"><span class="linenos">277</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_org_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="User-278"><a href="#User-278"><span class="linenos">278</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User-279"><a href="#User-279"><span class="linenos">279</span></a><span class="sd">        Verifica si es un administrador de organización.</span>
</span><span id="User-280"><a href="#User-280"><span class="linenos">280</span></a><span class="sd">        Returns:</span>
</span><span id="User-281"><a href="#User-281"><span class="linenos">281</span></a><span class="sd">            bool: True si es un administrador de organización, False en caso contrario.</span>
</span><span id="User-282"><a href="#User-282"><span class="linenos">282</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User-283"><a href="#User-283"><span class="linenos">283</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="n">RoleEnum</span><span class="o">.</span><span class="n">ORG_ADMIN</span>
</span><span id="User-284"><a href="#User-284"><span class="linenos">284</span></a>
</span><span id="User-285"><a href="#User-285"><span class="linenos">285</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_client_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">):</span>
</span><span id="User-286"><a href="#User-286"><span class="linenos">286</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User-287"><a href="#User-287"><span class="linenos">287</span></a><span class="sd">        Verifica si el usuario pertenece a un cliente específico.</span>
</span><span id="User-288"><a href="#User-288"><span class="linenos">288</span></a><span class="sd">        Args:</span>
</span><span id="User-289"><a href="#User-289"><span class="linenos">289</span></a><span class="sd">            client_id (int): El ID del cliente a verificar.</span>
</span><span id="User-290"><a href="#User-290"><span class="linenos">290</span></a><span class="sd">        Returns:</span>
</span><span id="User-291"><a href="#User-291"><span class="linenos">291</span></a><span class="sd">            bool: True si el usuario pertenece al cliente, False en caso contrario.</span>
</span><span id="User-292"><a href="#User-292"><span class="linenos">292</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User-293"><a href="#User-293"><span class="linenos">293</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span> <span class="o">==</span> <span class="n">client_id</span>
</span><span id="User-294"><a href="#User-294"><span class="linenos">294</span></a>
</span><span id="User-295"><a href="#User-295"><span class="linenos">295</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">have_role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role</span><span class="p">):</span>
</span><span id="User-296"><a href="#User-296"><span class="linenos">296</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User-297"><a href="#User-297"><span class="linenos">297</span></a><span class="sd">        Verifica si el usuario tiene un rol específico.</span>
</span><span id="User-298"><a href="#User-298"><span class="linenos">298</span></a><span class="sd">        Args:</span>
</span><span id="User-299"><a href="#User-299"><span class="linenos">299</span></a><span class="sd">            role (RoleEnum): El rol a verificar.</span>
</span><span id="User-300"><a href="#User-300"><span class="linenos">300</span></a><span class="sd">        Returns:</span>
</span><span id="User-301"><a href="#User-301"><span class="linenos">301</span></a><span class="sd">            bool: True si el usuario tiene el rol especificado, False en caso contrario.</span>
</span><span id="User-302"><a href="#User-302"><span class="linenos">302</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User-303"><a href="#User-303"><span class="linenos">303</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="n">role</span>
</span><span id="User-304"><a href="#User-304"><span class="linenos">304</span></a>
</span><span id="User-305"><a href="#User-305"><span class="linenos">305</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_role</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="User-306"><a href="#User-306"><span class="linenos">306</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Mostrar el nombre descriptivo del rol&quot;&quot;&quot;</span>
</span><span id="User-307"><a href="#User-307"><span class="linenos">307</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span><span class="o">.</span><span class="n">description</span>
</span><span id="User-308"><a href="#User-308"><span class="linenos">308</span></a>
</span><span id="User-309"><a href="#User-309"><span class="linenos">309</span></a>    <span class="nd">@classmethod</span>
</span><span id="User-310"><a href="#User-310"><span class="linenos">310</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_by_username</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
</span><span id="User-311"><a href="#User-311"><span class="linenos">311</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User-312"><a href="#User-312"><span class="linenos">312</span></a><span class="sd">        Obtiene un usuario por su nombre de usuario.</span>
</span><span id="User-313"><a href="#User-313"><span class="linenos">313</span></a><span class="sd">        Args:</span>
</span><span id="User-314"><a href="#User-314"><span class="linenos">314</span></a><span class="sd">            username (str): Nombre de usuario.</span>
</span><span id="User-315"><a href="#User-315"><span class="linenos">315</span></a><span class="sd">        Returns:</span>
</span><span id="User-316"><a href="#User-316"><span class="linenos">316</span></a><span class="sd">            User or None: El usuario si existe, None en caso contrario.</span>
</span><span id="User-317"><a href="#User-317"><span class="linenos">317</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User-318"><a href="#User-318"><span class="linenos">318</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="User-319"><a href="#User-319"><span class="linenos">319</span></a>
</span><span id="User-320"><a href="#User-320"><span class="linenos">320</span></a>    <span class="nd">@classmethod</span>
</span><span id="User-321"><a href="#User-321"><span class="linenos">321</span></a>    <span class="c1"># @lru_cache(maxsize=32)</span>
</span><span id="User-322"><a href="#User-322"><span class="linenos">322</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_by_email</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">):</span>
</span><span id="User-323"><a href="#User-323"><span class="linenos">323</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User-324"><a href="#User-324"><span class="linenos">324</span></a><span class="sd">        Obtiene un usuario por su correo electrónico.</span>
</span><span id="User-325"><a href="#User-325"><span class="linenos">325</span></a><span class="sd">        Args:</span>
</span><span id="User-326"><a href="#User-326"><span class="linenos">326</span></a><span class="sd">            email (str): Correo electrónico.</span>
</span><span id="User-327"><a href="#User-327"><span class="linenos">327</span></a><span class="sd">        Returns:</span>
</span><span id="User-328"><a href="#User-328"><span class="linenos">328</span></a><span class="sd">            User or None: El usuario si existe, None en caso contrario.</span>
</span><span id="User-329"><a href="#User-329"><span class="linenos">329</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User-330"><a href="#User-330"><span class="linenos">330</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="User-331"><a href="#User-331"><span class="linenos">331</span></a>
</span><span id="User-332"><a href="#User-332"><span class="linenos">332</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">assign_organization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organization_id</span><span class="p">):</span>
</span><span id="User-333"><a href="#User-333"><span class="linenos">333</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User-334"><a href="#User-334"><span class="linenos">334</span></a><span class="sd">        Asigna una organización a este usuario.</span>
</span><span id="User-335"><a href="#User-335"><span class="linenos">335</span></a><span class="sd">        Args:</span>
</span><span id="User-336"><a href="#User-336"><span class="linenos">336</span></a><span class="sd">            organization_id (int): ID de la organización a asignar.</span>
</span><span id="User-337"><a href="#User-337"><span class="linenos">337</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User-338"><a href="#User-338"><span class="linenos">338</span></a>        <span class="n">organization</span> <span class="o">=</span> <span class="n">Organization</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">organization_id</span><span class="p">)</span>
</span><span id="User-339"><a href="#User-339"><span class="linenos">339</span></a>        <span class="k">if</span> <span class="n">organization</span><span class="p">:</span>
</span><span id="User-340"><a href="#User-340"><span class="linenos">340</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">organizations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">organization</span><span class="p">)</span>
</span><span id="User-341"><a href="#User-341"><span class="linenos">341</span></a>            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span id="User-342"><a href="#User-342"><span class="linenos">342</span></a>
</span><span id="User-343"><a href="#User-343"><span class="linenos">343</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unassign_organization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organization_id</span><span class="p">):</span>
</span><span id="User-344"><a href="#User-344"><span class="linenos">344</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User-345"><a href="#User-345"><span class="linenos">345</span></a><span class="sd">        Desasigna una organización de este usuario.</span>
</span><span id="User-346"><a href="#User-346"><span class="linenos">346</span></a><span class="sd">        Args:</span>
</span><span id="User-347"><a href="#User-347"><span class="linenos">347</span></a><span class="sd">            organization_id (int): ID de la organización a desasignar.</span>
</span><span id="User-348"><a href="#User-348"><span class="linenos">348</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User-349"><a href="#User-349"><span class="linenos">349</span></a>        <span class="n">organization</span> <span class="o">=</span> <span class="n">Organization</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">organization_id</span><span class="p">)</span>
</span><span id="User-350"><a href="#User-350"><span class="linenos">350</span></a>        <span class="k">if</span> <span class="n">organization</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">organizations</span><span class="p">:</span>
</span><span id="User-351"><a href="#User-351"><span class="linenos">351</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">organizations</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">organization</span><span class="p">)</span>
</span><span id="User-352"><a href="#User-352"><span class="linenos">352</span></a>            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Modelo que representa a los usuarios del sistema.
Gestiona la información personal, credenciales de acceso, roles,
y la pertenencia a organizaciones (clientes).</p>
</div>


                            <div id="User.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">User</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">**</span><span class="n">kwargs</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#User.__init__"></a>
    
            <div class="docstring"><p>A simple constructor that allows initialization from kwargs.</p>

<p>Sets attributes on the constructed instance using the names and
values in <code>kwargs</code>.</p>

<p>Only keys that are present as
attributes of the instance's class are allowed. These could be,
for example, any mapped columns or relationships.</p>
</div>


                            </div>
                            <div id="User.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span>

        
    </div>
    <a class="headerlink" href="#User.id"></a>
    
            <div class="docstring"><p>Clave primaria única del usuario en formato UUID.</p>
</div>


                            </div>
                            <div id="User.username" class="classattr">
                                <div class="attr variable">
            <span class="name">username</span>

        
    </div>
    <a class="headerlink" href="#User.username"></a>
    
            <div class="docstring"><p>Nombre de usuario (String, único, no nulo, indexado). Utilizado para el login.</p>
</div>


                            </div>
                            <div id="User.email" class="classattr">
                                <div class="attr variable">
            <span class="name">email</span>

        
    </div>
    <a class="headerlink" href="#User.email"></a>
    
            <div class="docstring"><p>Dirección de correo electrónico (String, único, no nulo, indexado).</p>
</div>


                            </div>
                            <div id="User.full_name" class="classattr">
                                <div class="attr variable">
            <span class="name">full_name</span>

        
    </div>
    <a class="headerlink" href="#User.full_name"></a>
    
            <div class="docstring"><p>Nombre completo del usuario (String, no nulo).</p>
</div>


                            </div>
                            <div id="User.password_hash" class="classattr">
                                <div class="attr variable">
            <span class="name">password_hash</span>

        
    </div>
    <a class="headerlink" href="#User.password_hash"></a>
    
            <div class="docstring"><p>Hash de la contraseña (String). Almacena la contraseña de forma segura.</p>
</div>


                            </div>
                            <div id="User.profile_data" class="classattr">
                                <div class="attr variable">
            <span class="name">profile_data</span>

        
    </div>
    <a class="headerlink" href="#User.profile_data"></a>
    
            <div class="docstring"><p>Datos adicionales del perfil (JSON, valor por defecto: diccionario vacío). Permite almacenar información extra específica del usuario.</p>
</div>


                            </div>
                            <div id="User.created_at" class="classattr">
                                <div class="attr variable">
            <span class="name">created_at</span>

        
    </div>
    <a class="headerlink" href="#User.created_at"></a>
    
            <div class="docstring"><p>Fecha de creación del usuario (DateTime).</p>
</div>


                            </div>
                            <div id="User.updated_at" class="classattr">
                                <div class="attr variable">
            <span class="name">updated_at</span>

        
    </div>
    <a class="headerlink" href="#User.updated_at"></a>
    
            <div class="docstring"><p>Fecha de última actualización del usuario (DateTime). Se actualiza automáticamente.</p>
</div>


                            </div>
                            <div id="User.active" class="classattr">
                                <div class="attr variable">
            <span class="name">active</span>

        
    </div>
    <a class="headerlink" href="#User.active"></a>
    
            <div class="docstring"><p>Estado de la cuenta (Boolean, valor por defecto: True). Indica si la cuenta está activa o inactiva.</p>
</div>


                            </div>
                            <div id="User.role" class="classattr">
                                <div class="attr variable">
            <span class="name">role</span>

        
    </div>
    <a class="headerlink" href="#User.role"></a>
    
            <div class="docstring"><p>Rol del usuario (Enum, no nulo, valor por defecto: ORG_VIEWER). Define el rol del usuario en el sistema.</p>
</div>


                            </div>
                            <div id="User.reseller_packages" class="classattr">
                                <div class="attr variable">
            <span class="name">reseller_packages</span>

        
    </div>
    <a class="headerlink" href="#User.reseller_packages"></a>
    
    

                            </div>
                            <div id="User.organizations" class="classattr">
                                <div class="attr variable">
            <span class="name">organizations</span>

        
    </div>
    <a class="headerlink" href="#User.organizations"></a>
    
    

                            </div>
                            <div id="User.set_password" class="classattr">
                                        <input id="User.set_password-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_password</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">password</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="User.set_password-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#User.set_password"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="User.set_password-215"><a href="#User.set_password-215"><span class="linenos">215</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
</span><span id="User.set_password-216"><a href="#User.set_password-216"><span class="linenos">216</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User.set_password-217"><a href="#User.set_password-217"><span class="linenos">217</span></a><span class="sd">        Establece un hash seguro para la contraseña del usuario.</span>
</span><span id="User.set_password-218"><a href="#User.set_password-218"><span class="linenos">218</span></a><span class="sd">        Args:</span>
</span><span id="User.set_password-219"><a href="#User.set_password-219"><span class="linenos">219</span></a><span class="sd">            password (str): La contraseña en texto plano.</span>
</span><span id="User.set_password-220"><a href="#User.set_password-220"><span class="linenos">220</span></a><span class="sd">        Raises:</span>
</span><span id="User.set_password-221"><a href="#User.set_password-221"><span class="linenos">221</span></a><span class="sd">            ValueError: Si la contraseña no cumple con los requisitos de seguridad.</span>
</span><span id="User.set_password-222"><a href="#User.set_password-222"><span class="linenos">222</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User.set_password-223"><a href="#User.set_password-223"><span class="linenos">223</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">password_hash</span> <span class="o">=</span> <span class="n">generate_password_hash</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Establece un hash seguro para la contraseña del usuario.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>password (str):</strong>  La contraseña en texto plano.</li>
</ul>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  Si la contraseña no cumple con los requisitos de seguridad.</li>
</ul>
</div>


                            </div>
                            <div id="User.check_password" class="classattr">
                                        <input id="User.check_password-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_password</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">password</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="User.check_password-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#User.check_password"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="User.check_password-225"><a href="#User.check_password-225"><span class="linenos">225</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
</span><span id="User.check_password-226"><a href="#User.check_password-226"><span class="linenos">226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User.check_password-227"><a href="#User.check_password-227"><span class="linenos">227</span></a><span class="sd">        Verifica si la contraseña proporcionada coincide con el hash almacenado.</span>
</span><span id="User.check_password-228"><a href="#User.check_password-228"><span class="linenos">228</span></a><span class="sd">        Args:</span>
</span><span id="User.check_password-229"><a href="#User.check_password-229"><span class="linenos">229</span></a><span class="sd">            password (str): La contraseña en texto plano a verificar.</span>
</span><span id="User.check_password-230"><a href="#User.check_password-230"><span class="linenos">230</span></a><span class="sd">        Returns:</span>
</span><span id="User.check_password-231"><a href="#User.check_password-231"><span class="linenos">231</span></a><span class="sd">            bool: True si la contraseña coincide, False en caso contrario.</span>
</span><span id="User.check_password-232"><a href="#User.check_password-232"><span class="linenos">232</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User.check_password-233"><a href="#User.check_password-233"><span class="linenos">233</span></a>        <span class="k">return</span> <span class="n">check_password_hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">password_hash</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Verifica si la contraseña proporcionada coincide con el hash almacenado.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>password (str):</strong>  La contraseña en texto plano a verificar.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>bool: True si la contraseña coincide, False en caso contrario.</p>
</blockquote>
</div>


                            </div>
                            <div id="User.has_permission" class="classattr">
                                        <input id="User.has_permission-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">has_permission</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">permission_name</span>, </span><span class="param"><span class="n">action_name</span>, </span><span class="param"><span class="n">client_id</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="User.has_permission-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#User.has_permission"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="User.has_permission-235"><a href="#User.has_permission-235"><span class="linenos">235</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">has_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">permission_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">client_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="User.has_permission-236"><a href="#User.has_permission-236"><span class="linenos">236</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User.has_permission-237"><a href="#User.has_permission-237"><span class="linenos">237</span></a><span class="sd">        Verifica si el usuario tiene un permiso específico y opcionalmente dentro de un cliente específico.</span>
</span><span id="User.has_permission-238"><a href="#User.has_permission-238"><span class="linenos">238</span></a><span class="sd">        Args:</span>
</span><span id="User.has_permission-239"><a href="#User.has_permission-239"><span class="linenos">239</span></a><span class="sd">            permission_name (str): Nombre del permiso a verificar (ej: &#39;full_management&#39;).</span>
</span><span id="User.has_permission-240"><a href="#User.has_permission-240"><span class="linenos">240</span></a><span class="sd">            action_name (str): Nombre de la acción a verificar (ej: &#39;create&#39;).</span>
</span><span id="User.has_permission-241"><a href="#User.has_permission-241"><span class="linenos">241</span></a><span class="sd">            client_id (int, optional): ID del cliente para verificar el permiso dentro de ese cliente. Defaults to None.</span>
</span><span id="User.has_permission-242"><a href="#User.has_permission-242"><span class="linenos">242</span></a><span class="sd">        Returns:</span>
</span><span id="User.has_permission-243"><a href="#User.has_permission-243"><span class="linenos">243</span></a><span class="sd">            bool: True si el usuario tiene el permiso y la acción especificados, False en caso contrario.</span>
</span><span id="User.has_permission-244"><a href="#User.has_permission-244"><span class="linenos">244</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User.has_permission-245"><a href="#User.has_permission-245"><span class="linenos">245</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="User.has_permission-246"><a href="#User.has_permission-246"><span class="linenos">246</span></a>            <span class="n">perm_enum</span> <span class="o">=</span> <span class="n">PermissionEnum</span><span class="p">(</span><span class="n">permission_name</span><span class="p">)</span>
</span><span id="User.has_permission-247"><a href="#User.has_permission-247"><span class="linenos">247</span></a>            <span class="n">action_enum</span> <span class="o">=</span> <span class="n">ActionEnum</span><span class="p">(</span><span class="n">action_name</span><span class="p">)</span>
</span><span id="User.has_permission-248"><a href="#User.has_permission-248"><span class="linenos">248</span></a>
</span><span id="User.has_permission-249"><a href="#User.has_permission-249"><span class="linenos">249</span></a>            <span class="c1"># Verificar si el permiso está asignado al rol del usuario</span>
</span><span id="User.has_permission-250"><a href="#User.has_permission-250"><span class="linenos">250</span></a>            <span class="k">if</span> <span class="n">perm_enum</span> <span class="ow">in</span> <span class="n">ROLE_PERMISSIONS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">role</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="User.has_permission-251"><a href="#User.has_permission-251"><span class="linenos">251</span></a>                <span class="c1"># Verificar si la acción está permitida para ese permiso</span>
</span><span id="User.has_permission-252"><a href="#User.has_permission-252"><span class="linenos">252</span></a>                <span class="k">if</span> <span class="n">action_enum</span> <span class="ow">in</span> <span class="n">PERMISSION_ACTIONS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">perm_enum</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="User.has_permission-253"><a href="#User.has_permission-253"><span class="linenos">253</span></a>                    <span class="k">if</span> <span class="n">client_id</span><span class="p">:</span>
</span><span id="User.has_permission-254"><a href="#User.has_permission-254"><span class="linenos">254</span></a>                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span> <span class="o">==</span> <span class="n">client_id</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_admin</span><span class="p">()</span>
</span><span id="User.has_permission-255"><a href="#User.has_permission-255"><span class="linenos">255</span></a>                    <span class="k">return</span> <span class="kc">True</span>
</span><span id="User.has_permission-256"><a href="#User.has_permission-256"><span class="linenos">256</span></a>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="User.has_permission-257"><a href="#User.has_permission-257"><span class="linenos">257</span></a>            <span class="c1"># Si alguno de los valores no está en las enumeraciones, retornar False</span>
</span><span id="User.has_permission-258"><a href="#User.has_permission-258"><span class="linenos">258</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="User.has_permission-259"><a href="#User.has_permission-259"><span class="linenos">259</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Verifica si el usuario tiene un permiso específico y opcionalmente dentro de un cliente específico.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>permission_name (str):</strong>  Nombre del permiso a verificar (ej: 'full_management').</li>
<li><strong>action_name (str):</strong>  Nombre de la acción a verificar (ej: 'create').</li>
<li><strong>client_id (int, optional):</strong>  ID del cliente para verificar el permiso dentro de ese cliente. Defaults to None.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>bool: True si el usuario tiene el permiso y la acción especificados, False en caso contrario.</p>
</blockquote>
</div>


                            </div>
                            <div id="User.is_admin" class="classattr">
                                        <input id="User.is_admin-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_admin</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="User.is_admin-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#User.is_admin"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="User.is_admin-261"><a href="#User.is_admin-261"><span class="linenos">261</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_admin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="User.is_admin-262"><a href="#User.is_admin-262"><span class="linenos">262</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User.is_admin-263"><a href="#User.is_admin-263"><span class="linenos">263</span></a><span class="sd">        Verifica si el usuario tiene el rol de administrador.</span>
</span><span id="User.is_admin-264"><a href="#User.is_admin-264"><span class="linenos">264</span></a><span class="sd">        Returns:</span>
</span><span id="User.is_admin-265"><a href="#User.is_admin-265"><span class="linenos">265</span></a><span class="sd">            bool: True si el usuario tiene el rol de administrador, False en caso contrario.</span>
</span><span id="User.is_admin-266"><a href="#User.is_admin-266"><span class="linenos">266</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User.is_admin-267"><a href="#User.is_admin-267"><span class="linenos">267</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="n">RoleEnum</span><span class="o">.</span><span class="n">ADMINISTRATOR</span>
</span></pre></div>


            <div class="docstring"><p>Verifica si el usuario tiene el rol de administrador.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>bool: True si el usuario tiene el rol de administrador, False en caso contrario.</p>
</blockquote>
</div>


                            </div>
                            <div id="User.is_reseller" class="classattr">
                                        <input id="User.is_reseller-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_reseller</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="User.is_reseller-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#User.is_reseller"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="User.is_reseller-269"><a href="#User.is_reseller-269"><span class="linenos">269</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_reseller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="User.is_reseller-270"><a href="#User.is_reseller-270"><span class="linenos">270</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User.is_reseller-271"><a href="#User.is_reseller-271"><span class="linenos">271</span></a><span class="sd">        Verifica si el usuario tiene el rol de reseller.</span>
</span><span id="User.is_reseller-272"><a href="#User.is_reseller-272"><span class="linenos">272</span></a><span class="sd">        Returns:</span>
</span><span id="User.is_reseller-273"><a href="#User.is_reseller-273"><span class="linenos">273</span></a><span class="sd">            bool: True si el usuario tiene el rol de reseller, False en caso contrario.</span>
</span><span id="User.is_reseller-274"><a href="#User.is_reseller-274"><span class="linenos">274</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User.is_reseller-275"><a href="#User.is_reseller-275"><span class="linenos">275</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="n">RoleEnum</span><span class="o">.</span><span class="n">RESELLER</span>
</span></pre></div>


            <div class="docstring"><p>Verifica si el usuario tiene el rol de reseller.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>bool: True si el usuario tiene el rol de reseller, False en caso contrario.</p>
</blockquote>
</div>


                            </div>
                            <div id="User.is_org_manager" class="classattr">
                                        <input id="User.is_org_manager-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_org_manager</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="User.is_org_manager-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#User.is_org_manager"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="User.is_org_manager-277"><a href="#User.is_org_manager-277"><span class="linenos">277</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_org_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="User.is_org_manager-278"><a href="#User.is_org_manager-278"><span class="linenos">278</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User.is_org_manager-279"><a href="#User.is_org_manager-279"><span class="linenos">279</span></a><span class="sd">        Verifica si es un administrador de organización.</span>
</span><span id="User.is_org_manager-280"><a href="#User.is_org_manager-280"><span class="linenos">280</span></a><span class="sd">        Returns:</span>
</span><span id="User.is_org_manager-281"><a href="#User.is_org_manager-281"><span class="linenos">281</span></a><span class="sd">            bool: True si es un administrador de organización, False en caso contrario.</span>
</span><span id="User.is_org_manager-282"><a href="#User.is_org_manager-282"><span class="linenos">282</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User.is_org_manager-283"><a href="#User.is_org_manager-283"><span class="linenos">283</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="n">RoleEnum</span><span class="o">.</span><span class="n">ORG_ADMIN</span>
</span></pre></div>


            <div class="docstring"><p>Verifica si es un administrador de organización.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>bool: True si es un administrador de organización, False en caso contrario.</p>
</blockquote>
</div>


                            </div>
                            <div id="User.is_client_user" class="classattr">
                                        <input id="User.is_client_user-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_client_user</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">client_id</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="User.is_client_user-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#User.is_client_user"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="User.is_client_user-285"><a href="#User.is_client_user-285"><span class="linenos">285</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_client_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">):</span>
</span><span id="User.is_client_user-286"><a href="#User.is_client_user-286"><span class="linenos">286</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User.is_client_user-287"><a href="#User.is_client_user-287"><span class="linenos">287</span></a><span class="sd">        Verifica si el usuario pertenece a un cliente específico.</span>
</span><span id="User.is_client_user-288"><a href="#User.is_client_user-288"><span class="linenos">288</span></a><span class="sd">        Args:</span>
</span><span id="User.is_client_user-289"><a href="#User.is_client_user-289"><span class="linenos">289</span></a><span class="sd">            client_id (int): El ID del cliente a verificar.</span>
</span><span id="User.is_client_user-290"><a href="#User.is_client_user-290"><span class="linenos">290</span></a><span class="sd">        Returns:</span>
</span><span id="User.is_client_user-291"><a href="#User.is_client_user-291"><span class="linenos">291</span></a><span class="sd">            bool: True si el usuario pertenece al cliente, False en caso contrario.</span>
</span><span id="User.is_client_user-292"><a href="#User.is_client_user-292"><span class="linenos">292</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User.is_client_user-293"><a href="#User.is_client_user-293"><span class="linenos">293</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span> <span class="o">==</span> <span class="n">client_id</span>
</span></pre></div>


            <div class="docstring"><p>Verifica si el usuario pertenece a un cliente específico.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>client_id (int):</strong>  El ID del cliente a verificar.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>bool: True si el usuario pertenece al cliente, False en caso contrario.</p>
</blockquote>
</div>


                            </div>
                            <div id="User.have_role" class="classattr">
                                        <input id="User.have_role-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">have_role</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">role</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="User.have_role-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#User.have_role"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="User.have_role-295"><a href="#User.have_role-295"><span class="linenos">295</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">have_role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role</span><span class="p">):</span>
</span><span id="User.have_role-296"><a href="#User.have_role-296"><span class="linenos">296</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User.have_role-297"><a href="#User.have_role-297"><span class="linenos">297</span></a><span class="sd">        Verifica si el usuario tiene un rol específico.</span>
</span><span id="User.have_role-298"><a href="#User.have_role-298"><span class="linenos">298</span></a><span class="sd">        Args:</span>
</span><span id="User.have_role-299"><a href="#User.have_role-299"><span class="linenos">299</span></a><span class="sd">            role (RoleEnum): El rol a verificar.</span>
</span><span id="User.have_role-300"><a href="#User.have_role-300"><span class="linenos">300</span></a><span class="sd">        Returns:</span>
</span><span id="User.have_role-301"><a href="#User.have_role-301"><span class="linenos">301</span></a><span class="sd">            bool: True si el usuario tiene el rol especificado, False en caso contrario.</span>
</span><span id="User.have_role-302"><a href="#User.have_role-302"><span class="linenos">302</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User.have_role-303"><a href="#User.have_role-303"><span class="linenos">303</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="n">role</span>
</span></pre></div>


            <div class="docstring"><p>Verifica si el usuario tiene un rol específico.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>role (RoleEnum):</strong>  El rol a verificar.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>bool: True si el usuario tiene el rol especificado, False en caso contrario.</p>
</blockquote>
</div>


                            </div>
                            <div id="User.get_role" class="classattr">
                                        <input id="User.get_role-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_role</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="User.get_role-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#User.get_role"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="User.get_role-305"><a href="#User.get_role-305"><span class="linenos">305</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_role</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="User.get_role-306"><a href="#User.get_role-306"><span class="linenos">306</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Mostrar el nombre descriptivo del rol&quot;&quot;&quot;</span>
</span><span id="User.get_role-307"><a href="#User.get_role-307"><span class="linenos">307</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span><span class="o">.</span><span class="n">description</span>
</span></pre></div>


            <div class="docstring"><p>Mostrar el nombre descriptivo del rol</p>
</div>


                            </div>
                            <div id="User.get_by_username" class="classattr">
                                        <input id="User.get_by_username-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">get_by_username</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">username</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="User.get_by_username-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#User.get_by_username"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="User.get_by_username-309"><a href="#User.get_by_username-309"><span class="linenos">309</span></a>    <span class="nd">@classmethod</span>
</span><span id="User.get_by_username-310"><a href="#User.get_by_username-310"><span class="linenos">310</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_by_username</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
</span><span id="User.get_by_username-311"><a href="#User.get_by_username-311"><span class="linenos">311</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User.get_by_username-312"><a href="#User.get_by_username-312"><span class="linenos">312</span></a><span class="sd">        Obtiene un usuario por su nombre de usuario.</span>
</span><span id="User.get_by_username-313"><a href="#User.get_by_username-313"><span class="linenos">313</span></a><span class="sd">        Args:</span>
</span><span id="User.get_by_username-314"><a href="#User.get_by_username-314"><span class="linenos">314</span></a><span class="sd">            username (str): Nombre de usuario.</span>
</span><span id="User.get_by_username-315"><a href="#User.get_by_username-315"><span class="linenos">315</span></a><span class="sd">        Returns:</span>
</span><span id="User.get_by_username-316"><a href="#User.get_by_username-316"><span class="linenos">316</span></a><span class="sd">            User or None: El usuario si existe, None en caso contrario.</span>
</span><span id="User.get_by_username-317"><a href="#User.get_by_username-317"><span class="linenos">317</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User.get_by_username-318"><a href="#User.get_by_username-318"><span class="linenos">318</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Obtiene un usuario por su nombre de usuario.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>username (str):</strong>  Nombre de usuario.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>User or None: El usuario si existe, None en caso contrario.</p>
</blockquote>
</div>


                            </div>
                            <div id="User.get_by_email" class="classattr">
                                        <input id="User.get_by_email-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">get_by_email</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">email</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="User.get_by_email-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#User.get_by_email"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="User.get_by_email-320"><a href="#User.get_by_email-320"><span class="linenos">320</span></a>    <span class="nd">@classmethod</span>
</span><span id="User.get_by_email-321"><a href="#User.get_by_email-321"><span class="linenos">321</span></a>    <span class="c1"># @lru_cache(maxsize=32)</span>
</span><span id="User.get_by_email-322"><a href="#User.get_by_email-322"><span class="linenos">322</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_by_email</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">):</span>
</span><span id="User.get_by_email-323"><a href="#User.get_by_email-323"><span class="linenos">323</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User.get_by_email-324"><a href="#User.get_by_email-324"><span class="linenos">324</span></a><span class="sd">        Obtiene un usuario por su correo electrónico.</span>
</span><span id="User.get_by_email-325"><a href="#User.get_by_email-325"><span class="linenos">325</span></a><span class="sd">        Args:</span>
</span><span id="User.get_by_email-326"><a href="#User.get_by_email-326"><span class="linenos">326</span></a><span class="sd">            email (str): Correo electrónico.</span>
</span><span id="User.get_by_email-327"><a href="#User.get_by_email-327"><span class="linenos">327</span></a><span class="sd">        Returns:</span>
</span><span id="User.get_by_email-328"><a href="#User.get_by_email-328"><span class="linenos">328</span></a><span class="sd">            User or None: El usuario si existe, None en caso contrario.</span>
</span><span id="User.get_by_email-329"><a href="#User.get_by_email-329"><span class="linenos">329</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User.get_by_email-330"><a href="#User.get_by_email-330"><span class="linenos">330</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Obtiene un usuario por su correo electrónico.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>email (str):</strong>  Correo electrónico.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>User or None: El usuario si existe, None en caso contrario.</p>
</blockquote>
</div>


                            </div>
                            <div id="User.assign_organization" class="classattr">
                                        <input id="User.assign_organization-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">assign_organization</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">organization_id</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="User.assign_organization-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#User.assign_organization"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="User.assign_organization-332"><a href="#User.assign_organization-332"><span class="linenos">332</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">assign_organization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organization_id</span><span class="p">):</span>
</span><span id="User.assign_organization-333"><a href="#User.assign_organization-333"><span class="linenos">333</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User.assign_organization-334"><a href="#User.assign_organization-334"><span class="linenos">334</span></a><span class="sd">        Asigna una organización a este usuario.</span>
</span><span id="User.assign_organization-335"><a href="#User.assign_organization-335"><span class="linenos">335</span></a><span class="sd">        Args:</span>
</span><span id="User.assign_organization-336"><a href="#User.assign_organization-336"><span class="linenos">336</span></a><span class="sd">            organization_id (int): ID de la organización a asignar.</span>
</span><span id="User.assign_organization-337"><a href="#User.assign_organization-337"><span class="linenos">337</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User.assign_organization-338"><a href="#User.assign_organization-338"><span class="linenos">338</span></a>        <span class="n">organization</span> <span class="o">=</span> <span class="n">Organization</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">organization_id</span><span class="p">)</span>
</span><span id="User.assign_organization-339"><a href="#User.assign_organization-339"><span class="linenos">339</span></a>        <span class="k">if</span> <span class="n">organization</span><span class="p">:</span>
</span><span id="User.assign_organization-340"><a href="#User.assign_organization-340"><span class="linenos">340</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">organizations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">organization</span><span class="p">)</span>
</span><span id="User.assign_organization-341"><a href="#User.assign_organization-341"><span class="linenos">341</span></a>            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Asigna una organización a este usuario.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>organization_id (int):</strong>  ID de la organización a asignar.</li>
</ul>
</div>


                            </div>
                            <div id="User.unassign_organization" class="classattr">
                                        <input id="User.unassign_organization-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unassign_organization</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">organization_id</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="User.unassign_organization-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#User.unassign_organization"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="User.unassign_organization-343"><a href="#User.unassign_organization-343"><span class="linenos">343</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unassign_organization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organization_id</span><span class="p">):</span>
</span><span id="User.unassign_organization-344"><a href="#User.unassign_organization-344"><span class="linenos">344</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="User.unassign_organization-345"><a href="#User.unassign_organization-345"><span class="linenos">345</span></a><span class="sd">        Desasigna una organización de este usuario.</span>
</span><span id="User.unassign_organization-346"><a href="#User.unassign_organization-346"><span class="linenos">346</span></a><span class="sd">        Args:</span>
</span><span id="User.unassign_organization-347"><a href="#User.unassign_organization-347"><span class="linenos">347</span></a><span class="sd">            organization_id (int): ID de la organización a desasignar.</span>
</span><span id="User.unassign_organization-348"><a href="#User.unassign_organization-348"><span class="linenos">348</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="User.unassign_organization-349"><a href="#User.unassign_organization-349"><span class="linenos">349</span></a>        <span class="n">organization</span> <span class="o">=</span> <span class="n">Organization</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">organization_id</span><span class="p">)</span>
</span><span id="User.unassign_organization-350"><a href="#User.unassign_organization-350"><span class="linenos">350</span></a>        <span class="k">if</span> <span class="n">organization</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">organizations</span><span class="p">:</span>
</span><span id="User.unassign_organization-351"><a href="#User.unassign_organization-351"><span class="linenos">351</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">organizations</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">organization</span><span class="p">)</span>
</span><span id="User.unassign_organization-352"><a href="#User.unassign_organization-352"><span class="linenos">352</span></a>            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Desasigna una organización de este usuario.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>organization_id (int):</strong>  ID de la organización a desasignar.</li>
</ul>
</div>


                            </div>
                </section>
                <section id="Organization">
                            <input id="Organization-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Organization</span><wbr>(<span class="base">sqlalchemy.orm.decl_api._DynamicAttributesType</span>, <span class="base">sqlalchemy.inspection.Inspectable[sqlalchemy.orm.mapper.Mapper[typing.Any]]</span>):

                <label class="view-source-button" for="Organization-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Organization"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Organization-354"><a href="#Organization-354"><span class="linenos">354</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Organization</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="Organization-355"><a href="#Organization-355"><span class="linenos">355</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Modelo que representa a los clientes u organizaciones en el sistema.&quot;&quot;&quot;</span>
</span><span id="Organization-356"><a href="#Organization-356"><span class="linenos">356</span></a>
</span><span id="Organization-357"><a href="#Organization-357"><span class="linenos">357</span></a>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;organizations&quot;</span>
</span><span id="Organization-358"><a href="#Organization-358"><span class="linenos">358</span></a>    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="Organization-359"><a href="#Organization-359"><span class="linenos">359</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> 
</span><span id="Organization-360"><a href="#Organization-360"><span class="linenos">360</span></a>        <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
</span><span id="Organization-361"><a href="#Organization-361"><span class="linenos">361</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Clave primaria única del cliente.&quot;</span>
</span><span id="Organization-362"><a href="#Organization-362"><span class="linenos">362</span></a>    <span class="p">)</span>
</span><span id="Organization-363"><a href="#Organization-363"><span class="linenos">363</span></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="Organization-364"><a href="#Organization-364"><span class="linenos">364</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> 
</span><span id="Organization-365"><a href="#Organization-365"><span class="linenos">365</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
</span><span id="Organization-366"><a href="#Organization-366"><span class="linenos">366</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Nombre del cliente (String, no nulo).&quot;</span>
</span><span id="Organization-367"><a href="#Organization-367"><span class="linenos">367</span></a>    <span class="p">)</span>
</span><span id="Organization-368"><a href="#Organization-368"><span class="linenos">368</span></a>    <span class="n">description</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="Organization-369"><a href="#Organization-369"><span class="linenos">369</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
</span><span id="Organization-370"><a href="#Organization-370"><span class="linenos">370</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Descripción del cliente. Proporciona información adicional sobre el cliente u organización.&quot;</span><span class="p">,</span>
</span><span id="Organization-371"><a href="#Organization-371"><span class="linenos">371</span></a>    <span class="p">)</span>
</span><span id="Organization-372"><a href="#Organization-372"><span class="linenos">372</span></a>    <span class="n">profile_data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="Organization-373"><a href="#Organization-373"><span class="linenos">373</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">JSON</span><span class="p">,</span>
</span><span id="Organization-374"><a href="#Organization-374"><span class="linenos">374</span></a>        <span class="n">default</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
</span><span id="Organization-375"><a href="#Organization-375"><span class="linenos">375</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Datos adicionales del cliente (JSON, valor por defecto: diccionario vacío). Permite almacenar información extra específica del cliente.&quot;</span><span class="p">,</span>
</span><span id="Organization-376"><a href="#Organization-376"><span class="linenos">376</span></a>    <span class="p">)</span>
</span><span id="Organization-377"><a href="#Organization-377"><span class="linenos">377</span></a>    <span class="n">reseller_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="Organization-378"><a href="#Organization-378"><span class="linenos">378</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span>
</span><span id="Organization-379"><a href="#Organization-379"><span class="linenos">379</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;reseller_packages.id&quot;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;SET NULL&quot;</span><span class="p">),</span>  
</span><span id="Organization-380"><a href="#Organization-380"><span class="linenos">380</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  
</span><span id="Organization-381"><a href="#Organization-381"><span class="linenos">381</span></a>        <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Organization-382"><a href="#Organization-382"><span class="linenos">382</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Relación opcional con el paquete de reseller&quot;</span>
</span><span id="Organization-383"><a href="#Organization-383"><span class="linenos">383</span></a>    <span class="p">)</span>
</span><span id="Organization-384"><a href="#Organization-384"><span class="linenos">384</span></a>    <span class="n">created_at</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="Organization-385"><a href="#Organization-385"><span class="linenos">385</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">DateTime</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Fecha de creación del cliente.&quot;</span>
</span><span id="Organization-386"><a href="#Organization-386"><span class="linenos">386</span></a>    <span class="p">)</span>
</span><span id="Organization-387"><a href="#Organization-387"><span class="linenos">387</span></a>    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="Organization-388"><a href="#Organization-388"><span class="linenos">388</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">DateTime</span><span class="p">,</span>
</span><span id="Organization-389"><a href="#Organization-389"><span class="linenos">389</span></a>        <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">,</span>
</span><span id="Organization-390"><a href="#Organization-390"><span class="linenos">390</span></a>        <span class="n">onupdate</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">,</span>
</span><span id="Organization-391"><a href="#Organization-391"><span class="linenos">391</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Fecha de última actualización del cliente.&quot;</span><span class="p">,</span>
</span><span id="Organization-392"><a href="#Organization-392"><span class="linenos">392</span></a>    <span class="p">)</span>
</span><span id="Organization-393"><a href="#Organization-393"><span class="linenos">393</span></a>    <span class="n">active</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="Organization-394"><a href="#Organization-394"><span class="linenos">394</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">Boolean</span><span class="p">,</span>
</span><span id="Organization-395"><a href="#Organization-395"><span class="linenos">395</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Organization-396"><a href="#Organization-396"><span class="linenos">396</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Estado del cliente (Boolean, valor por defecto: True). Indica si el cliente está activo o inactivo.&quot;</span><span class="p">,</span>
</span><span id="Organization-397"><a href="#Organization-397"><span class="linenos">397</span></a>    <span class="p">)</span>
</span><span id="Organization-398"><a href="#Organization-398"><span class="linenos">398</span></a>    <span class="c1"># Relación con ResellerPackage</span>
</span><span id="Organization-399"><a href="#Organization-399"><span class="linenos">399</span></a>    <span class="n">reseller_package</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;ResellerPackage&quot;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;organizations&quot;</span><span class="p">)</span>
</span><span id="Organization-400"><a href="#Organization-400"><span class="linenos">400</span></a>
</span><span id="Organization-401"><a href="#Organization-401"><span class="linenos">401</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Organization-402"><a href="#Organization-402"><span class="linenos">402</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Representación en cadena del objeto Organization.</span>
</span><span id="Organization-403"><a href="#Organization-403"><span class="linenos">403</span></a><span class="sd">        Returns:</span>
</span><span id="Organization-404"><a href="#Organization-404"><span class="linenos">404</span></a><span class="sd">            str: Representación en cadena del cliente.</span>
</span><span id="Organization-405"><a href="#Organization-405"><span class="linenos">405</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Organization-406"><a href="#Organization-406"><span class="linenos">406</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;Organization </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
</span><span id="Organization-407"><a href="#Organization-407"><span class="linenos">407</span></a>
</span><span id="Organization-408"><a href="#Organization-408"><span class="linenos">408</span></a>    <span class="nd">@property</span>
</span><span id="Organization-409"><a href="#Organization-409"><span class="linenos">409</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_reseller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Organization-410"><a href="#Organization-410"><span class="linenos">410</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Organization-411"><a href="#Organization-411"><span class="linenos">411</span></a><span class="sd">        Obtiene el usuario reseller asociado a la organización, si existe.</span>
</span><span id="Organization-412"><a href="#Organization-412"><span class="linenos">412</span></a><span class="sd">        Returns:</span>
</span><span id="Organization-413"><a href="#Organization-413"><span class="linenos">413</span></a><span class="sd">            User or None: El usuario reseller si existe, None en caso contrario</span>
</span><span id="Organization-414"><a href="#Organization-414"><span class="linenos">414</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Organization-415"><a href="#Organization-415"><span class="linenos">415</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reseller_package</span><span class="p">:</span>
</span><span id="Organization-416"><a href="#Organization-416"><span class="linenos">416</span></a>            <span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reseller_package</span><span class="o">.</span><span class="n">reseller_id</span><span class="p">)</span>
</span><span id="Organization-417"><a href="#Organization-417"><span class="linenos">417</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="Organization-418"><a href="#Organization-418"><span class="linenos">418</span></a>
</span><span id="Organization-419"><a href="#Organization-419"><span class="linenos">419</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_users</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Organization-420"><a href="#Organization-420"><span class="linenos">420</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Organization-421"><a href="#Organization-421"><span class="linenos">421</span></a><span class="sd">        Devuelve los ID de los usuarios asociados a este cliente.</span>
</span><span id="Organization-422"><a href="#Organization-422"><span class="linenos">422</span></a><span class="sd">        Returns:</span>
</span><span id="Organization-423"><a href="#Organization-423"><span class="linenos">423</span></a><span class="sd">            list: Lista de IDs de usuarios.</span>
</span><span id="Organization-424"><a href="#Organization-424"><span class="linenos">424</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Organization-425"><a href="#Organization-425"><span class="linenos">425</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">user</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Modelo que representa a los clientes u organizaciones en el sistema.</p>
</div>


                            <div id="Organization.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Organization</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">**</span><span class="n">kwargs</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Organization.__init__"></a>
    
            <div class="docstring"><p>A simple constructor that allows initialization from kwargs.</p>

<p>Sets attributes on the constructed instance using the names and
values in <code>kwargs</code>.</p>

<p>Only keys that are present as
attributes of the instance's class are allowed. These could be,
for example, any mapped columns or relationships.</p>
</div>


                            </div>
                            <div id="Organization.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span>

        
    </div>
    <a class="headerlink" href="#Organization.id"></a>
    
            <div class="docstring"><p>Clave primaria única del cliente.</p>
</div>


                            </div>
                            <div id="Organization.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span>

        
    </div>
    <a class="headerlink" href="#Organization.name"></a>
    
            <div class="docstring"><p>Nombre del cliente (String, no nulo).</p>
</div>


                            </div>
                            <div id="Organization.description" class="classattr">
                                <div class="attr variable">
            <span class="name">description</span>

        
    </div>
    <a class="headerlink" href="#Organization.description"></a>
    
            <div class="docstring"><p>Descripción del cliente. Proporciona información adicional sobre el cliente u organización.</p>
</div>


                            </div>
                            <div id="Organization.profile_data" class="classattr">
                                <div class="attr variable">
            <span class="name">profile_data</span>

        
    </div>
    <a class="headerlink" href="#Organization.profile_data"></a>
    
            <div class="docstring"><p>Datos adicionales del cliente (JSON, valor por defecto: diccionario vacío). Permite almacenar información extra específica del cliente.</p>
</div>


                            </div>
                            <div id="Organization.reseller_id" class="classattr">
                                <div class="attr variable">
            <span class="name">reseller_id</span>

        
    </div>
    <a class="headerlink" href="#Organization.reseller_id"></a>
    
            <div class="docstring"><p>Relación opcional con el paquete de reseller</p>
</div>


                            </div>
                            <div id="Organization.created_at" class="classattr">
                                <div class="attr variable">
            <span class="name">created_at</span>

        
    </div>
    <a class="headerlink" href="#Organization.created_at"></a>
    
            <div class="docstring"><p>Fecha de creación del cliente.</p>
</div>


                            </div>
                            <div id="Organization.updated_at" class="classattr">
                                <div class="attr variable">
            <span class="name">updated_at</span>

        
    </div>
    <a class="headerlink" href="#Organization.updated_at"></a>
    
            <div class="docstring"><p>Fecha de última actualización del cliente.</p>
</div>


                            </div>
                            <div id="Organization.active" class="classattr">
                                <div class="attr variable">
            <span class="name">active</span>

        
    </div>
    <a class="headerlink" href="#Organization.active"></a>
    
            <div class="docstring"><p>Estado del cliente (Boolean, valor por defecto: True). Indica si el cliente está activo o inactivo.</p>
</div>


                            </div>
                            <div id="Organization.reseller_package" class="classattr">
                                <div class="attr variable">
            <span class="name">reseller_package</span>

        
    </div>
    <a class="headerlink" href="#Organization.reseller_package"></a>
    
    

                            </div>
                            <div id="Organization.get_reseller" class="classattr">
                                        <input id="Organization.get_reseller-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">get_reseller</span>

                <label class="view-source-button" for="Organization.get_reseller-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Organization.get_reseller"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Organization.get_reseller-408"><a href="#Organization.get_reseller-408"><span class="linenos">408</span></a>    <span class="nd">@property</span>
</span><span id="Organization.get_reseller-409"><a href="#Organization.get_reseller-409"><span class="linenos">409</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_reseller</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Organization.get_reseller-410"><a href="#Organization.get_reseller-410"><span class="linenos">410</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Organization.get_reseller-411"><a href="#Organization.get_reseller-411"><span class="linenos">411</span></a><span class="sd">        Obtiene el usuario reseller asociado a la organización, si existe.</span>
</span><span id="Organization.get_reseller-412"><a href="#Organization.get_reseller-412"><span class="linenos">412</span></a><span class="sd">        Returns:</span>
</span><span id="Organization.get_reseller-413"><a href="#Organization.get_reseller-413"><span class="linenos">413</span></a><span class="sd">            User or None: El usuario reseller si existe, None en caso contrario</span>
</span><span id="Organization.get_reseller-414"><a href="#Organization.get_reseller-414"><span class="linenos">414</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Organization.get_reseller-415"><a href="#Organization.get_reseller-415"><span class="linenos">415</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reseller_package</span><span class="p">:</span>
</span><span id="Organization.get_reseller-416"><a href="#Organization.get_reseller-416"><span class="linenos">416</span></a>            <span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reseller_package</span><span class="o">.</span><span class="n">reseller_id</span><span class="p">)</span>
</span><span id="Organization.get_reseller-417"><a href="#Organization.get_reseller-417"><span class="linenos">417</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Obtiene el usuario reseller asociado a la organización, si existe.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>User or None: El usuario reseller si existe, None en caso contrario</p>
</blockquote>
</div>


                            </div>
                            <div id="Organization.get_users" class="classattr">
                                        <input id="Organization.get_users-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_users</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Organization.get_users-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Organization.get_users"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Organization.get_users-419"><a href="#Organization.get_users-419"><span class="linenos">419</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_users</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Organization.get_users-420"><a href="#Organization.get_users-420"><span class="linenos">420</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Organization.get_users-421"><a href="#Organization.get_users-421"><span class="linenos">421</span></a><span class="sd">        Devuelve los ID de los usuarios asociados a este cliente.</span>
</span><span id="Organization.get_users-422"><a href="#Organization.get_users-422"><span class="linenos">422</span></a><span class="sd">        Returns:</span>
</span><span id="Organization.get_users-423"><a href="#Organization.get_users-423"><span class="linenos">423</span></a><span class="sd">            list: Lista de IDs de usuarios.</span>
</span><span id="Organization.get_users-424"><a href="#Organization.get_users-424"><span class="linenos">424</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Organization.get_users-425"><a href="#Organization.get_users-425"><span class="linenos">425</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">user</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Devuelve los ID de los usuarios asociados a este cliente.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>list: Lista de IDs de usuarios.</p>
</blockquote>
</div>


                            </div>
                            <div id="Organization.users" class="classattr">
                                <div class="attr variable">
            <span class="name">users</span>

        
    </div>
    <a class="headerlink" href="#Organization.users"></a>
    
    

                            </div>
                            <div id="Organization.farms" class="classattr">
                                <div class="attr variable">
            <span class="name">farms</span>

        
    </div>
    <a class="headerlink" href="#Organization.farms"></a>
    
    

                            </div>
                </section>
                <section id="ResellerPackage">
                            <input id="ResellerPackage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ResellerPackage</span><wbr>(<span class="base">sqlalchemy.orm.decl_api._DynamicAttributesType</span>, <span class="base">sqlalchemy.inspection.Inspectable[sqlalchemy.orm.mapper.Mapper[typing.Any]]</span>):

                <label class="view-source-button" for="ResellerPackage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ResellerPackage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ResellerPackage-428"><a href="#ResellerPackage-428"><span class="linenos">428</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ResellerPackage</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="ResellerPackage-429"><a href="#ResellerPackage-429"><span class="linenos">429</span></a>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;reseller_packages&quot;</span>
</span><span id="ResellerPackage-430"><a href="#ResellerPackage-430"><span class="linenos">430</span></a>    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="ResellerPackage-431"><a href="#ResellerPackage-431"><span class="linenos">431</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span>
</span><span id="ResellerPackage-432"><a href="#ResellerPackage-432"><span class="linenos">432</span></a>        <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ResellerPackage-433"><a href="#ResellerPackage-433"><span class="linenos">433</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Clave primaria única del paquete de reseller.&quot;</span><span class="p">,</span>
</span><span id="ResellerPackage-434"><a href="#ResellerPackage-434"><span class="linenos">434</span></a>    <span class="p">)</span>
</span><span id="ResellerPackage-435"><a href="#ResellerPackage-435"><span class="linenos">435</span></a>    <span class="n">reseller_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="ResellerPackage-436"><a href="#ResellerPackage-436"><span class="linenos">436</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
</span><span id="ResellerPackage-437"><a href="#ResellerPackage-437"><span class="linenos">437</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;users.id&quot;</span><span class="p">),</span>
</span><span id="ResellerPackage-438"><a href="#ResellerPackage-438"><span class="linenos">438</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ResellerPackage-439"><a href="#ResellerPackage-439"><span class="linenos">439</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;ID del usuario reseller (UUID).&quot;</span><span class="p">,</span>
</span><span id="ResellerPackage-440"><a href="#ResellerPackage-440"><span class="linenos">440</span></a>    <span class="p">)</span>
</span><span id="ResellerPackage-441"><a href="#ResellerPackage-441"><span class="linenos">441</span></a>
</span><span id="ResellerPackage-442"><a href="#ResellerPackage-442"><span class="linenos">442</span></a>    <span class="n">max_clients</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="ResellerPackage-443"><a href="#ResellerPackage-443"><span class="linenos">443</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span>
</span><span id="ResellerPackage-444"><a href="#ResellerPackage-444"><span class="linenos">444</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span id="ResellerPackage-445"><a href="#ResellerPackage-445"><span class="linenos">445</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ResellerPackage-446"><a href="#ResellerPackage-446"><span class="linenos">446</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Número máximo de clientes permitidos en este paquete de reseller.&quot;</span><span class="p">,</span>
</span><span id="ResellerPackage-447"><a href="#ResellerPackage-447"><span class="linenos">447</span></a>    <span class="p">)</span>
</span><span id="ResellerPackage-448"><a href="#ResellerPackage-448"><span class="linenos">448</span></a>    <span class="n">current_clients</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span>
</span><span id="ResellerPackage-449"><a href="#ResellerPackage-449"><span class="linenos">449</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span>
</span><span id="ResellerPackage-450"><a href="#ResellerPackage-450"><span class="linenos">450</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="ResellerPackage-451"><a href="#ResellerPackage-451"><span class="linenos">451</span></a>        <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ResellerPackage-452"><a href="#ResellerPackage-452"><span class="linenos">452</span></a>        <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Total de clientes asignados hasta el momento a ese reseller.&quot;</span><span class="p">,</span>
</span><span id="ResellerPackage-453"><a href="#ResellerPackage-453"><span class="linenos">453</span></a>    <span class="p">)</span>
</span><span id="ResellerPackage-454"><a href="#ResellerPackage-454"><span class="linenos">454</span></a>
</span><span id="ResellerPackage-455"><a href="#ResellerPackage-455"><span class="linenos">455</span></a>    <span class="c1"># Constraint a nivel de base de datos</span>
</span><span id="ResellerPackage-456"><a href="#ResellerPackage-456"><span class="linenos">456</span></a>    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ResellerPackage-457"><a href="#ResellerPackage-457"><span class="linenos">457</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">CheckConstraint</span><span class="p">(</span><span class="s2">&quot;current_clients &lt;= max_clients&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;check_client_limit&quot;</span><span class="p">),</span>
</span><span id="ResellerPackage-458"><a href="#ResellerPackage-458"><span class="linenos">458</span></a>    <span class="p">)</span>
</span><span id="ResellerPackage-459"><a href="#ResellerPackage-459"><span class="linenos">459</span></a>
</span><span id="ResellerPackage-460"><a href="#ResellerPackage-460"><span class="linenos">460</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResellerPackage-461"><a href="#ResellerPackage-461"><span class="linenos">461</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResellerPackage-462"><a href="#ResellerPackage-462"><span class="linenos">462</span></a><span class="sd">        Verifica si el reseller puede crear más clientes.</span>
</span><span id="ResellerPackage-463"><a href="#ResellerPackage-463"><span class="linenos">463</span></a><span class="sd">        Returns:</span>
</span><span id="ResellerPackage-464"><a href="#ResellerPackage-464"><span class="linenos">464</span></a><span class="sd">            bool: True si puede crear más clientes, False en caso contrario.</span>
</span><span id="ResellerPackage-465"><a href="#ResellerPackage-465"><span class="linenos">465</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResellerPackage-466"><a href="#ResellerPackage-466"><span class="linenos">466</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_clients</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_clients</span>
</span><span id="ResellerPackage-467"><a href="#ResellerPackage-467"><span class="linenos">467</span></a>
</span><span id="ResellerPackage-468"><a href="#ResellerPackage-468"><span class="linenos">468</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">increase_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResellerPackage-469"><a href="#ResellerPackage-469"><span class="linenos">469</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResellerPackage-470"><a href="#ResellerPackage-470"><span class="linenos">470</span></a><span class="sd">        Incrementa el contador de clientes.</span>
</span><span id="ResellerPackage-471"><a href="#ResellerPackage-471"><span class="linenos">471</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResellerPackage-472"><a href="#ResellerPackage-472"><span class="linenos">472</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_clients</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ResellerPackage-473"><a href="#ResellerPackage-473"><span class="linenos">473</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span id="ResellerPackage-474"><a href="#ResellerPackage-474"><span class="linenos">474</span></a>
</span><span id="ResellerPackage-475"><a href="#ResellerPackage-475"><span class="linenos">475</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decrease_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResellerPackage-476"><a href="#ResellerPackage-476"><span class="linenos">476</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResellerPackage-477"><a href="#ResellerPackage-477"><span class="linenos">477</span></a><span class="sd">        Decrementa el contador de clientes.</span>
</span><span id="ResellerPackage-478"><a href="#ResellerPackage-478"><span class="linenos">478</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResellerPackage-479"><a href="#ResellerPackage-479"><span class="linenos">479</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_clients</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ResellerPackage-480"><a href="#ResellerPackage-480"><span class="linenos">480</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">current_clients</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="ResellerPackage-481"><a href="#ResellerPackage-481"><span class="linenos">481</span></a>            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span id="ResellerPackage-482"><a href="#ResellerPackage-482"><span class="linenos">482</span></a>
</span><span id="ResellerPackage-483"><a href="#ResellerPackage-483"><span class="linenos">483</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_available_slots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResellerPackage-484"><a href="#ResellerPackage-484"><span class="linenos">484</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResellerPackage-485"><a href="#ResellerPackage-485"><span class="linenos">485</span></a><span class="sd">        Obtiene el número de espacios disponibles para nuevos clientes.</span>
</span><span id="ResellerPackage-486"><a href="#ResellerPackage-486"><span class="linenos">486</span></a><span class="sd">        Returns:</span>
</span><span id="ResellerPackage-487"><a href="#ResellerPackage-487"><span class="linenos">487</span></a><span class="sd">            int: Número de espacios disponibles</span>
</span><span id="ResellerPackage-488"><a href="#ResellerPackage-488"><span class="linenos">488</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResellerPackage-489"><a href="#ResellerPackage-489"><span class="linenos">489</span></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_clients</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_clients</span><span class="p">)</span>
</span><span id="ResellerPackage-490"><a href="#ResellerPackage-490"><span class="linenos">490</span></a>
</span><span id="ResellerPackage-491"><a href="#ResellerPackage-491"><span class="linenos">491</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">assign_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organization</span><span class="p">):</span>
</span><span id="ResellerPackage-492"><a href="#ResellerPackage-492"><span class="linenos">492</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResellerPackage-493"><a href="#ResellerPackage-493"><span class="linenos">493</span></a><span class="sd">        Asigna un cliente a este reseller si hay espacios disponibles.</span>
</span><span id="ResellerPackage-494"><a href="#ResellerPackage-494"><span class="linenos">494</span></a><span class="sd">        Args:</span>
</span><span id="ResellerPackage-495"><a href="#ResellerPackage-495"><span class="linenos">495</span></a><span class="sd">            client (Client): Cliente a asignar</span>
</span><span id="ResellerPackage-496"><a href="#ResellerPackage-496"><span class="linenos">496</span></a><span class="sd">        Returns:</span>
</span><span id="ResellerPackage-497"><a href="#ResellerPackage-497"><span class="linenos">497</span></a><span class="sd">            bool: True si se asignó correctamente, False en caso contrario</span>
</span><span id="ResellerPackage-498"><a href="#ResellerPackage-498"><span class="linenos">498</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResellerPackage-499"><a href="#ResellerPackage-499"><span class="linenos">499</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_client</span><span class="p">():</span>
</span><span id="ResellerPackage-500"><a href="#ResellerPackage-500"><span class="linenos">500</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ResellerPackage-501"><a href="#ResellerPackage-501"><span class="linenos">501</span></a>
</span><span id="ResellerPackage-502"><a href="#ResellerPackage-502"><span class="linenos">502</span></a>        <span class="n">organization</span><span class="o">.</span><span class="n">reseller_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
</span><span id="ResellerPackage-503"><a href="#ResellerPackage-503"><span class="linenos">503</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">increase_client</span><span class="p">()</span>
</span><span id="ResellerPackage-504"><a href="#ResellerPackage-504"><span class="linenos">504</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="ResellerPackage-505"><a href="#ResellerPackage-505"><span class="linenos">505</span></a>
</span><span id="ResellerPackage-506"><a href="#ResellerPackage-506"><span class="linenos">506</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unassign_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organizarion</span><span class="p">):</span>
</span><span id="ResellerPackage-507"><a href="#ResellerPackage-507"><span class="linenos">507</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResellerPackage-508"><a href="#ResellerPackage-508"><span class="linenos">508</span></a><span class="sd">        Desasigna un cliente de este reseller.</span>
</span><span id="ResellerPackage-509"><a href="#ResellerPackage-509"><span class="linenos">509</span></a><span class="sd">        Args:</span>
</span><span id="ResellerPackage-510"><a href="#ResellerPackage-510"><span class="linenos">510</span></a><span class="sd">            client (Client): Cliente a desasignar</span>
</span><span id="ResellerPackage-511"><a href="#ResellerPackage-511"><span class="linenos">511</span></a><span class="sd">        Returns:</span>
</span><span id="ResellerPackage-512"><a href="#ResellerPackage-512"><span class="linenos">512</span></a><span class="sd">            bool: True si se desasignó correctamente, False en caso contrario</span>
</span><span id="ResellerPackage-513"><a href="#ResellerPackage-513"><span class="linenos">513</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResellerPackage-514"><a href="#ResellerPackage-514"><span class="linenos">514</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">reseller_id</span> <span class="o">==</span> <span class="n">organizarion</span><span class="o">.</span><span class="n">reseller_id</span><span class="p">:</span>
</span><span id="ResellerPackage-515"><a href="#ResellerPackage-515"><span class="linenos">515</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ResellerPackage-516"><a href="#ResellerPackage-516"><span class="linenos">516</span></a>
</span><span id="ResellerPackage-517"><a href="#ResellerPackage-517"><span class="linenos">517</span></a>        <span class="n">organizarion</span><span class="o">.</span><span class="n">reseller_package_id</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ResellerPackage-518"><a href="#ResellerPackage-518"><span class="linenos">518</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">decrease_client</span><span class="p">()</span>
</span><span id="ResellerPackage-519"><a href="#ResellerPackage-519"><span class="linenos">519</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="ResellerPackage-520"><a href="#ResellerPackage-520"><span class="linenos">520</span></a>
</span><span id="ResellerPackage-521"><a href="#ResellerPackage-521"><span class="linenos">521</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_users_clients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResellerPackage-522"><a href="#ResellerPackage-522"><span class="linenos">522</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResellerPackage-523"><a href="#ResellerPackage-523"><span class="linenos">523</span></a><span class="sd">        Obtiene el listado de todos los usuarios que son parte de los clientes de este reseller.</span>
</span><span id="ResellerPackage-524"><a href="#ResellerPackage-524"><span class="linenos">524</span></a>
</span><span id="ResellerPackage-525"><a href="#ResellerPackage-525"><span class="linenos">525</span></a><span class="sd">        Returns:</span>
</span><span id="ResellerPackage-526"><a href="#ResellerPackage-526"><span class="linenos">526</span></a><span class="sd">            list: Lista de usuarios asociados a los clientes del reseller.</span>
</span><span id="ResellerPackage-527"><a href="#ResellerPackage-527"><span class="linenos">527</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResellerPackage-528"><a href="#ResellerPackage-528"><span class="linenos">528</span></a>        <span class="n">users</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ResellerPackage-529"><a href="#ResellerPackage-529"><span class="linenos">529</span></a>        <span class="k">for</span> <span class="n">organization</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">organizations</span><span class="p">:</span>
</span><span id="ResellerPackage-530"><a href="#ResellerPackage-530"><span class="linenos">530</span></a>            <span class="n">users</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">organization</span><span class="o">.</span><span class="n">users</span><span class="p">)</span>
</span><span id="ResellerPackage-531"><a href="#ResellerPackage-531"><span class="linenos">531</span></a>        <span class="k">return</span> <span class="n">users</span>
</span></pre></div>


            <div class="docstring"><p>The base class of the <code>.SQLAlchemy.Model</code> declarative model class.</p>

<p>To define models, subclass <code>db.Model &lt;.SQLAlchemy.Model&gt;</code>, not this. To
customize <code>db.Model</code>, subclass this and pass it as <code>model_class</code> to
<code>.SQLAlchemy</code>. To customize <code>db.Model</code> at the metaclass level, pass an
already created declarative model class as <code>model_class</code>.</p>
</div>


                            <div id="ResellerPackage.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">ResellerPackage</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">**</span><span class="n">kwargs</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#ResellerPackage.__init__"></a>
    
            <div class="docstring"><p>A simple constructor that allows initialization from kwargs.</p>

<p>Sets attributes on the constructed instance using the names and
values in <code>kwargs</code>.</p>

<p>Only keys that are present as
attributes of the instance's class are allowed. These could be,
for example, any mapped columns or relationships.</p>
</div>


                            </div>
                            <div id="ResellerPackage.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span>

        
    </div>
    <a class="headerlink" href="#ResellerPackage.id"></a>
    
            <div class="docstring"><p>Clave primaria única del paquete de reseller.</p>
</div>


                            </div>
                            <div id="ResellerPackage.reseller_id" class="classattr">
                                <div class="attr variable">
            <span class="name">reseller_id</span>

        
    </div>
    <a class="headerlink" href="#ResellerPackage.reseller_id"></a>
    
            <div class="docstring"><p>ID del usuario reseller (UUID).</p>
</div>


                            </div>
                            <div id="ResellerPackage.max_clients" class="classattr">
                                <div class="attr variable">
            <span class="name">max_clients</span>

        
    </div>
    <a class="headerlink" href="#ResellerPackage.max_clients"></a>
    
            <div class="docstring"><p>Número máximo de clientes permitidos en este paquete de reseller.</p>
</div>


                            </div>
                            <div id="ResellerPackage.current_clients" class="classattr">
                                <div class="attr variable">
            <span class="name">current_clients</span>

        
    </div>
    <a class="headerlink" href="#ResellerPackage.current_clients"></a>
    
            <div class="docstring"><p>Total de clientes asignados hasta el momento a ese reseller.</p>
</div>


                            </div>
                            <div id="ResellerPackage.add_client" class="classattr">
                                        <input id="ResellerPackage.add_client-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_client</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ResellerPackage.add_client-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ResellerPackage.add_client"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ResellerPackage.add_client-460"><a href="#ResellerPackage.add_client-460"><span class="linenos">460</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResellerPackage.add_client-461"><a href="#ResellerPackage.add_client-461"><span class="linenos">461</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResellerPackage.add_client-462"><a href="#ResellerPackage.add_client-462"><span class="linenos">462</span></a><span class="sd">        Verifica si el reseller puede crear más clientes.</span>
</span><span id="ResellerPackage.add_client-463"><a href="#ResellerPackage.add_client-463"><span class="linenos">463</span></a><span class="sd">        Returns:</span>
</span><span id="ResellerPackage.add_client-464"><a href="#ResellerPackage.add_client-464"><span class="linenos">464</span></a><span class="sd">            bool: True si puede crear más clientes, False en caso contrario.</span>
</span><span id="ResellerPackage.add_client-465"><a href="#ResellerPackage.add_client-465"><span class="linenos">465</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResellerPackage.add_client-466"><a href="#ResellerPackage.add_client-466"><span class="linenos">466</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_clients</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_clients</span>
</span></pre></div>


            <div class="docstring"><p>Verifica si el reseller puede crear más clientes.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>bool: True si puede crear más clientes, False en caso contrario.</p>
</blockquote>
</div>


                            </div>
                            <div id="ResellerPackage.increase_client" class="classattr">
                                        <input id="ResellerPackage.increase_client-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">increase_client</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ResellerPackage.increase_client-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ResellerPackage.increase_client"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ResellerPackage.increase_client-468"><a href="#ResellerPackage.increase_client-468"><span class="linenos">468</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">increase_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResellerPackage.increase_client-469"><a href="#ResellerPackage.increase_client-469"><span class="linenos">469</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResellerPackage.increase_client-470"><a href="#ResellerPackage.increase_client-470"><span class="linenos">470</span></a><span class="sd">        Incrementa el contador de clientes.</span>
</span><span id="ResellerPackage.increase_client-471"><a href="#ResellerPackage.increase_client-471"><span class="linenos">471</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResellerPackage.increase_client-472"><a href="#ResellerPackage.increase_client-472"><span class="linenos">472</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">current_clients</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="ResellerPackage.increase_client-473"><a href="#ResellerPackage.increase_client-473"><span class="linenos">473</span></a>        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Incrementa el contador de clientes.</p>
</div>


                            </div>
                            <div id="ResellerPackage.decrease_client" class="classattr">
                                        <input id="ResellerPackage.decrease_client-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">decrease_client</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ResellerPackage.decrease_client-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ResellerPackage.decrease_client"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ResellerPackage.decrease_client-475"><a href="#ResellerPackage.decrease_client-475"><span class="linenos">475</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decrease_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResellerPackage.decrease_client-476"><a href="#ResellerPackage.decrease_client-476"><span class="linenos">476</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResellerPackage.decrease_client-477"><a href="#ResellerPackage.decrease_client-477"><span class="linenos">477</span></a><span class="sd">        Decrementa el contador de clientes.</span>
</span><span id="ResellerPackage.decrease_client-478"><a href="#ResellerPackage.decrease_client-478"><span class="linenos">478</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResellerPackage.decrease_client-479"><a href="#ResellerPackage.decrease_client-479"><span class="linenos">479</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_clients</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ResellerPackage.decrease_client-480"><a href="#ResellerPackage.decrease_client-480"><span class="linenos">480</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">current_clients</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="ResellerPackage.decrease_client-481"><a href="#ResellerPackage.decrease_client-481"><span class="linenos">481</span></a>            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Decrementa el contador de clientes.</p>
</div>


                            </div>
                            <div id="ResellerPackage.get_available_slots" class="classattr">
                                        <input id="ResellerPackage.get_available_slots-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_available_slots</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ResellerPackage.get_available_slots-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ResellerPackage.get_available_slots"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ResellerPackage.get_available_slots-483"><a href="#ResellerPackage.get_available_slots-483"><span class="linenos">483</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_available_slots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResellerPackage.get_available_slots-484"><a href="#ResellerPackage.get_available_slots-484"><span class="linenos">484</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResellerPackage.get_available_slots-485"><a href="#ResellerPackage.get_available_slots-485"><span class="linenos">485</span></a><span class="sd">        Obtiene el número de espacios disponibles para nuevos clientes.</span>
</span><span id="ResellerPackage.get_available_slots-486"><a href="#ResellerPackage.get_available_slots-486"><span class="linenos">486</span></a><span class="sd">        Returns:</span>
</span><span id="ResellerPackage.get_available_slots-487"><a href="#ResellerPackage.get_available_slots-487"><span class="linenos">487</span></a><span class="sd">            int: Número de espacios disponibles</span>
</span><span id="ResellerPackage.get_available_slots-488"><a href="#ResellerPackage.get_available_slots-488"><span class="linenos">488</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResellerPackage.get_available_slots-489"><a href="#ResellerPackage.get_available_slots-489"><span class="linenos">489</span></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_clients</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_clients</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Obtiene el número de espacios disponibles para nuevos clientes.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>int: Número de espacios disponibles</p>
</blockquote>
</div>


                            </div>
                            <div id="ResellerPackage.assign_client" class="classattr">
                                        <input id="ResellerPackage.assign_client-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">assign_client</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">organization</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ResellerPackage.assign_client-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ResellerPackage.assign_client"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ResellerPackage.assign_client-491"><a href="#ResellerPackage.assign_client-491"><span class="linenos">491</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">assign_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organization</span><span class="p">):</span>
</span><span id="ResellerPackage.assign_client-492"><a href="#ResellerPackage.assign_client-492"><span class="linenos">492</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResellerPackage.assign_client-493"><a href="#ResellerPackage.assign_client-493"><span class="linenos">493</span></a><span class="sd">        Asigna un cliente a este reseller si hay espacios disponibles.</span>
</span><span id="ResellerPackage.assign_client-494"><a href="#ResellerPackage.assign_client-494"><span class="linenos">494</span></a><span class="sd">        Args:</span>
</span><span id="ResellerPackage.assign_client-495"><a href="#ResellerPackage.assign_client-495"><span class="linenos">495</span></a><span class="sd">            client (Client): Cliente a asignar</span>
</span><span id="ResellerPackage.assign_client-496"><a href="#ResellerPackage.assign_client-496"><span class="linenos">496</span></a><span class="sd">        Returns:</span>
</span><span id="ResellerPackage.assign_client-497"><a href="#ResellerPackage.assign_client-497"><span class="linenos">497</span></a><span class="sd">            bool: True si se asignó correctamente, False en caso contrario</span>
</span><span id="ResellerPackage.assign_client-498"><a href="#ResellerPackage.assign_client-498"><span class="linenos">498</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResellerPackage.assign_client-499"><a href="#ResellerPackage.assign_client-499"><span class="linenos">499</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_client</span><span class="p">():</span>
</span><span id="ResellerPackage.assign_client-500"><a href="#ResellerPackage.assign_client-500"><span class="linenos">500</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ResellerPackage.assign_client-501"><a href="#ResellerPackage.assign_client-501"><span class="linenos">501</span></a>
</span><span id="ResellerPackage.assign_client-502"><a href="#ResellerPackage.assign_client-502"><span class="linenos">502</span></a>        <span class="n">organization</span><span class="o">.</span><span class="n">reseller_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
</span><span id="ResellerPackage.assign_client-503"><a href="#ResellerPackage.assign_client-503"><span class="linenos">503</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">increase_client</span><span class="p">()</span>
</span><span id="ResellerPackage.assign_client-504"><a href="#ResellerPackage.assign_client-504"><span class="linenos">504</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Asigna un cliente a este reseller si hay espacios disponibles.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>client (Client):</strong>  Cliente a asignar</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>bool: True si se asignó correctamente, False en caso contrario</p>
</blockquote>
</div>


                            </div>
                            <div id="ResellerPackage.unassign_client" class="classattr">
                                        <input id="ResellerPackage.unassign_client-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unassign_client</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">organizarion</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ResellerPackage.unassign_client-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ResellerPackage.unassign_client"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ResellerPackage.unassign_client-506"><a href="#ResellerPackage.unassign_client-506"><span class="linenos">506</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">unassign_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">organizarion</span><span class="p">):</span>
</span><span id="ResellerPackage.unassign_client-507"><a href="#ResellerPackage.unassign_client-507"><span class="linenos">507</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResellerPackage.unassign_client-508"><a href="#ResellerPackage.unassign_client-508"><span class="linenos">508</span></a><span class="sd">        Desasigna un cliente de este reseller.</span>
</span><span id="ResellerPackage.unassign_client-509"><a href="#ResellerPackage.unassign_client-509"><span class="linenos">509</span></a><span class="sd">        Args:</span>
</span><span id="ResellerPackage.unassign_client-510"><a href="#ResellerPackage.unassign_client-510"><span class="linenos">510</span></a><span class="sd">            client (Client): Cliente a desasignar</span>
</span><span id="ResellerPackage.unassign_client-511"><a href="#ResellerPackage.unassign_client-511"><span class="linenos">511</span></a><span class="sd">        Returns:</span>
</span><span id="ResellerPackage.unassign_client-512"><a href="#ResellerPackage.unassign_client-512"><span class="linenos">512</span></a><span class="sd">            bool: True si se desasignó correctamente, False en caso contrario</span>
</span><span id="ResellerPackage.unassign_client-513"><a href="#ResellerPackage.unassign_client-513"><span class="linenos">513</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResellerPackage.unassign_client-514"><a href="#ResellerPackage.unassign_client-514"><span class="linenos">514</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">reseller_id</span> <span class="o">==</span> <span class="n">organizarion</span><span class="o">.</span><span class="n">reseller_id</span><span class="p">:</span>
</span><span id="ResellerPackage.unassign_client-515"><a href="#ResellerPackage.unassign_client-515"><span class="linenos">515</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ResellerPackage.unassign_client-516"><a href="#ResellerPackage.unassign_client-516"><span class="linenos">516</span></a>
</span><span id="ResellerPackage.unassign_client-517"><a href="#ResellerPackage.unassign_client-517"><span class="linenos">517</span></a>        <span class="n">organizarion</span><span class="o">.</span><span class="n">reseller_package_id</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ResellerPackage.unassign_client-518"><a href="#ResellerPackage.unassign_client-518"><span class="linenos">518</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">decrease_client</span><span class="p">()</span>
</span><span id="ResellerPackage.unassign_client-519"><a href="#ResellerPackage.unassign_client-519"><span class="linenos">519</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Desasigna un cliente de este reseller.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>client (Client):</strong>  Cliente a desasignar</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>bool: True si se desasignó correctamente, False en caso contrario</p>
</blockquote>
</div>


                            </div>
                            <div id="ResellerPackage.get_all_users_clients" class="classattr">
                                        <input id="ResellerPackage.get_all_users_clients-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_all_users_clients</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ResellerPackage.get_all_users_clients-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ResellerPackage.get_all_users_clients"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ResellerPackage.get_all_users_clients-521"><a href="#ResellerPackage.get_all_users_clients-521"><span class="linenos">521</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_users_clients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ResellerPackage.get_all_users_clients-522"><a href="#ResellerPackage.get_all_users_clients-522"><span class="linenos">522</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ResellerPackage.get_all_users_clients-523"><a href="#ResellerPackage.get_all_users_clients-523"><span class="linenos">523</span></a><span class="sd">        Obtiene el listado de todos los usuarios que son parte de los clientes de este reseller.</span>
</span><span id="ResellerPackage.get_all_users_clients-524"><a href="#ResellerPackage.get_all_users_clients-524"><span class="linenos">524</span></a>
</span><span id="ResellerPackage.get_all_users_clients-525"><a href="#ResellerPackage.get_all_users_clients-525"><span class="linenos">525</span></a><span class="sd">        Returns:</span>
</span><span id="ResellerPackage.get_all_users_clients-526"><a href="#ResellerPackage.get_all_users_clients-526"><span class="linenos">526</span></a><span class="sd">            list: Lista de usuarios asociados a los clientes del reseller.</span>
</span><span id="ResellerPackage.get_all_users_clients-527"><a href="#ResellerPackage.get_all_users_clients-527"><span class="linenos">527</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ResellerPackage.get_all_users_clients-528"><a href="#ResellerPackage.get_all_users_clients-528"><span class="linenos">528</span></a>        <span class="n">users</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ResellerPackage.get_all_users_clients-529"><a href="#ResellerPackage.get_all_users_clients-529"><span class="linenos">529</span></a>        <span class="k">for</span> <span class="n">organization</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">organizations</span><span class="p">:</span>
</span><span id="ResellerPackage.get_all_users_clients-530"><a href="#ResellerPackage.get_all_users_clients-530"><span class="linenos">530</span></a>            <span class="n">users</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">organization</span><span class="o">.</span><span class="n">users</span><span class="p">)</span>
</span><span id="ResellerPackage.get_all_users_clients-531"><a href="#ResellerPackage.get_all_users_clients-531"><span class="linenos">531</span></a>        <span class="k">return</span> <span class="n">users</span>
</span></pre></div>


            <div class="docstring"><p>Obtiene el listado de todos los usuarios que son parte de los clientes de este reseller.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>list: Lista de usuarios asociados a los clientes del reseller.</p>
</blockquote>
</div>


                            </div>
                            <div id="ResellerPackage.reseller" class="classattr">
                                <div class="attr variable">
            <span class="name">reseller</span>

        
    </div>
    <a class="headerlink" href="#ResellerPackage.reseller"></a>
    
    

                            </div>
                            <div id="ResellerPackage.organizations" class="classattr">
                                <div class="attr variable">
            <span class="name">organizations</span>

        
    </div>
    <a class="headerlink" href="#ResellerPackage.organizations"></a>
    
    

                            </div>
                </section>
                <section id="check_permission">
                            <input id="check_permission-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-lru_cache">@lru_cache(maxsize=128)</div>

        <span class="def">def</span>
        <span class="name">check_permission</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">user_id</span>, </span><span class="param"><span class="n">permission_name</span>, </span><span class="param"><span class="n">action_name</span>, </span><span class="param"><span class="n">client_id</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="check_permission-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#check_permission"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="check_permission-538"><a href="#check_permission-538"><span class="linenos">538</span></a><span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
</span><span id="check_permission-539"><a href="#check_permission-539"><span class="linenos">539</span></a><span class="k">def</span><span class="w"> </span><span class="nf">check_permission</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">permission_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">client_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="check_permission-540"><a href="#check_permission-540"><span class="linenos">540</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="check_permission-541"><a href="#check_permission-541"><span class="linenos">541</span></a><span class="sd">    Verifica permisos de forma centralizada y cacheada.</span>
</span><span id="check_permission-542"><a href="#check_permission-542"><span class="linenos">542</span></a><span class="sd">    Args:</span>
</span><span id="check_permission-543"><a href="#check_permission-543"><span class="linenos">543</span></a><span class="sd">        user_id: (int): ID del usuario</span>
</span><span id="check_permission-544"><a href="#check_permission-544"><span class="linenos">544</span></a><span class="sd">        permission_name (str): Nombre del permiso a verificar (ej: &#39;full_management&#39;)</span>
</span><span id="check_permission-545"><a href="#check_permission-545"><span class="linenos">545</span></a><span class="sd">        action_name (str): Nombre de la acción a verificar (ej: &#39;create&#39;)</span>
</span><span id="check_permission-546"><a href="#check_permission-546"><span class="linenos">546</span></a><span class="sd">        client_id (int): ID de la organización (opcional)</span>
</span><span id="check_permission-547"><a href="#check_permission-547"><span class="linenos">547</span></a>
</span><span id="check_permission-548"><a href="#check_permission-548"><span class="linenos">548</span></a><span class="sd">    Returns:</span>
</span><span id="check_permission-549"><a href="#check_permission-549"><span class="linenos">549</span></a><span class="sd">        bool: True si el usuario tiene el permiso, False en caso contrario</span>
</span><span id="check_permission-550"><a href="#check_permission-550"><span class="linenos">550</span></a>
</span><span id="check_permission-551"><a href="#check_permission-551"><span class="linenos">551</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="check_permission-552"><a href="#check_permission-552"><span class="linenos">552</span></a>    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="check_permission-553"><a href="#check_permission-553"><span class="linenos">553</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
</span><span id="check_permission-554"><a href="#check_permission-554"><span class="linenos">554</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="check_permission-555"><a href="#check_permission-555"><span class="linenos">555</span></a>
</span><span id="check_permission-556"><a href="#check_permission-556"><span class="linenos">556</span></a>    <span class="k">return</span> <span class="n">user</span><span class="o">.</span><span class="n">has_permission</span><span class="p">(</span><span class="n">permission_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">client_id</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Verifica permisos de forma centralizada y cacheada.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>user_id:</strong>  (int): ID del usuario</li>
<li><strong>permission_name (str):</strong>  Nombre del permiso a verificar (ej: 'full_management')</li>
<li><strong>action_name (str):</strong>  Nombre de la acción a verificar (ej: 'create')</li>
<li><strong>client_id (int):</strong>  ID de la organización (opcional)</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>bool: True si el usuario tiene el permiso, False en caso contrario</p>
</blockquote>
</div>


                </section>
                <section id="verify_user_credentials">
                            <input id="verify_user_credentials-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">verify_user_credentials</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">username</span>, </span><span class="param"><span class="n">password</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="verify_user_credentials-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#verify_user_credentials"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="verify_user_credentials-559"><a href="#verify_user_credentials-559"><span class="linenos">559</span></a><span class="k">def</span><span class="w"> </span><span class="nf">verify_user_credentials</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
</span><span id="verify_user_credentials-560"><a href="#verify_user_credentials-560"><span class="linenos">560</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="verify_user_credentials-561"><a href="#verify_user_credentials-561"><span class="linenos">561</span></a><span class="sd">    Verifica las credenciales de un usuario de forma segura.</span>
</span><span id="verify_user_credentials-562"><a href="#verify_user_credentials-562"><span class="linenos">562</span></a>
</span><span id="verify_user_credentials-563"><a href="#verify_user_credentials-563"><span class="linenos">563</span></a><span class="sd">    Args:</span>
</span><span id="verify_user_credentials-564"><a href="#verify_user_credentials-564"><span class="linenos">564</span></a><span class="sd">        username (str): Nombre de usuario</span>
</span><span id="verify_user_credentials-565"><a href="#verify_user_credentials-565"><span class="linenos">565</span></a><span class="sd">        password (str): Contraseña en texto plano</span>
</span><span id="verify_user_credentials-566"><a href="#verify_user_credentials-566"><span class="linenos">566</span></a>
</span><span id="verify_user_credentials-567"><a href="#verify_user_credentials-567"><span class="linenos">567</span></a><span class="sd">    Returns:</span>
</span><span id="verify_user_credentials-568"><a href="#verify_user_credentials-568"><span class="linenos">568</span></a><span class="sd">        User or None: El usuario si las credenciales son correctas, None en caso contrario</span>
</span><span id="verify_user_credentials-569"><a href="#verify_user_credentials-569"><span class="linenos">569</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="verify_user_credentials-570"><a href="#verify_user_credentials-570"><span class="linenos">570</span></a>    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="verify_user_credentials-571"><a href="#verify_user_credentials-571"><span class="linenos">571</span></a>    <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">user</span><span class="o">.</span><span class="n">check_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="ow">and</span> <span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
</span><span id="verify_user_credentials-572"><a href="#verify_user_credentials-572"><span class="linenos">572</span></a>        <span class="k">return</span> <span class="n">user</span>
</span><span id="verify_user_credentials-573"><a href="#verify_user_credentials-573"><span class="linenos">573</span></a>    <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Verifica las credenciales de un usuario de forma segura.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>username (str):</strong>  Nombre de usuario</li>
<li><strong>password (str):</strong>  Contraseña en texto plano</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>User or None: El usuario si las credenciales son correctas, None en caso contrario</p>
</blockquote>
</div>


                </section>
                <section id="verify_user_in_organization">
                            <input id="verify_user_in_organization-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">verify_user_in_organization</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">org_id</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="verify_user_in_organization-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#verify_user_in_organization"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="verify_user_in_organization-576"><a href="#verify_user_in_organization-576"><span class="linenos">576</span></a><span class="k">def</span><span class="w"> </span><span class="nf">verify_user_in_organization</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">org_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="verify_user_in_organization-577"><a href="#verify_user_in_organization-577"><span class="linenos">577</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="verify_user_in_organization-578"><a href="#verify_user_in_organization-578"><span class="linenos">578</span></a><span class="sd">    Verifica si un usuario pertenece a una organización específica.</span>
</span><span id="verify_user_in_organization-579"><a href="#verify_user_in_organization-579"><span class="linenos">579</span></a>
</span><span id="verify_user_in_organization-580"><a href="#verify_user_in_organization-580"><span class="linenos">580</span></a><span class="sd">    Args:</span>
</span><span id="verify_user_in_organization-581"><a href="#verify_user_in_organization-581"><span class="linenos">581</span></a><span class="sd">        user_id (str): ID del usuario (UUID en formato string).</span>
</span><span id="verify_user_in_organization-582"><a href="#verify_user_in_organization-582"><span class="linenos">582</span></a><span class="sd">        org_id (int): ID de la organización.</span>
</span><span id="verify_user_in_organization-583"><a href="#verify_user_in_organization-583"><span class="linenos">583</span></a>
</span><span id="verify_user_in_organization-584"><a href="#verify_user_in_organization-584"><span class="linenos">584</span></a><span class="sd">    Returns:</span>
</span><span id="verify_user_in_organization-585"><a href="#verify_user_in_organization-585"><span class="linenos">585</span></a><span class="sd">        bool: True si el usuario pertenece a la organización o tiene permisos especiales,</span>
</span><span id="verify_user_in_organization-586"><a href="#verify_user_in_organization-586"><span class="linenos">586</span></a><span class="sd">              False en caso contrario.</span>
</span><span id="verify_user_in_organization-587"><a href="#verify_user_in_organization-587"><span class="linenos">587</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="verify_user_in_organization-588"><a href="#verify_user_in_organization-588"><span class="linenos">588</span></a>    <span class="c1"># Obtener el usuario por su ID</span>
</span><span id="verify_user_in_organization-589"><a href="#verify_user_in_organization-589"><span class="linenos">589</span></a>    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="verify_user_in_organization-590"><a href="#verify_user_in_organization-590"><span class="linenos">590</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
</span><span id="verify_user_in_organization-591"><a href="#verify_user_in_organization-591"><span class="linenos">591</span></a>        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># El usuario no existe, retorna False</span>
</span><span id="verify_user_in_organization-592"><a href="#verify_user_in_organization-592"><span class="linenos">592</span></a>
</span><span id="verify_user_in_organization-593"><a href="#verify_user_in_organization-593"><span class="linenos">593</span></a>    <span class="c1"># Si el usuario es administrador, tiene acceso implícito a todas las organizaciones</span>
</span><span id="verify_user_in_organization-594"><a href="#verify_user_in_organization-594"><span class="linenos">594</span></a>    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">is_admin</span><span class="p">():</span>
</span><span id="verify_user_in_organization-595"><a href="#verify_user_in_organization-595"><span class="linenos">595</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="verify_user_in_organization-596"><a href="#verify_user_in_organization-596"><span class="linenos">596</span></a>
</span><span id="verify_user_in_organization-597"><a href="#verify_user_in_organization-597"><span class="linenos">597</span></a>    <span class="c1"># Verificar si el usuario es un reseller y la organización pertenece a su paquete</span>
</span><span id="verify_user_in_organization-598"><a href="#verify_user_in_organization-598"><span class="linenos">598</span></a>    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">is_reseller</span><span class="p">():</span>
</span><span id="verify_user_in_organization-599"><a href="#verify_user_in_organization-599"><span class="linenos">599</span></a>        <span class="c1"># Obtener el paquete del reseller asociado al usuario</span>
</span><span id="verify_user_in_organization-600"><a href="#verify_user_in_organization-600"><span class="linenos">600</span></a>        <span class="n">reseller_package</span> <span class="o">=</span> <span class="n">ResellerPackage</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">reseller_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="verify_user_in_organization-601"><a href="#verify_user_in_organization-601"><span class="linenos">601</span></a>        <span class="k">if</span> <span class="n">reseller_package</span><span class="p">:</span>
</span><span id="verify_user_in_organization-602"><a href="#verify_user_in_organization-602"><span class="linenos">602</span></a>            <span class="c1"># Verificar si la organización está en las organizaciones del paquete del reseller</span>
</span><span id="verify_user_in_organization-603"><a href="#verify_user_in_organization-603"><span class="linenos">603</span></a>            <span class="n">organization</span> <span class="o">=</span> <span class="n">Organization</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span>
</span><span id="verify_user_in_organization-604"><a href="#verify_user_in_organization-604"><span class="linenos">604</span></a>                <span class="nb">id</span><span class="o">=</span><span class="n">org_id</span><span class="p">,</span> <span class="n">reseller_id</span><span class="o">=</span><span class="n">reseller_package</span><span class="o">.</span><span class="n">id</span>
</span><span id="verify_user_in_organization-605"><a href="#verify_user_in_organization-605"><span class="linenos">605</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span id="verify_user_in_organization-606"><a href="#verify_user_in_organization-606"><span class="linenos">606</span></a>            <span class="k">if</span> <span class="n">organization</span><span class="p">:</span>
</span><span id="verify_user_in_organization-607"><a href="#verify_user_in_organization-607"><span class="linenos">607</span></a>                <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># La organización pertenece al reseller</span>
</span><span id="verify_user_in_organization-608"><a href="#verify_user_in_organization-608"><span class="linenos">608</span></a>
</span><span id="verify_user_in_organization-609"><a href="#verify_user_in_organization-609"><span class="linenos">609</span></a>    <span class="c1"># Verificar si el usuario está directamente asociado a la organización</span>
</span><span id="verify_user_in_organization-610"><a href="#verify_user_in_organization-610"><span class="linenos">610</span></a>    <span class="c1"># Usamos la relación &#39;organizations&#39; del modelo User</span>
</span><span id="verify_user_in_organization-611"><a href="#verify_user_in_organization-611"><span class="linenos">611</span></a>    <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">org</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">org_id</span> <span class="k">for</span> <span class="n">org</span> <span class="ow">in</span> <span class="n">user</span><span class="o">.</span><span class="n">organizations</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Verifica si un usuario pertenece a una organización específica.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>user_id (str):</strong>  ID del usuario (UUID en formato string).</li>
<li><strong>org_id (int):</strong>  ID de la organización.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>bool: True si el usuario pertenece a la organización o tiene permisos especiales,
        False en caso contrario.</p>
</blockquote>
</div>


                </section>
                <section id="get_clients_for_user">
                            <input id="get_clients_for_user-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_clients_for_user</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_clients_for_user-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_clients_for_user"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_clients_for_user-615"><a href="#get_clients_for_user-615"><span class="linenos">615</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_clients_for_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="get_clients_for_user-616"><a href="#get_clients_for_user-616"><span class="linenos">616</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_clients_for_user-617"><a href="#get_clients_for_user-617"><span class="linenos">617</span></a><span class="sd">    Obtiene el listado de clientes asignados a un usuario específico.</span>
</span><span id="get_clients_for_user-618"><a href="#get_clients_for_user-618"><span class="linenos">618</span></a><span class="sd">    Args:</span>
</span><span id="get_clients_for_user-619"><a href="#get_clients_for_user-619"><span class="linenos">619</span></a><span class="sd">        user_id (str): ID del usuario (UUID en formato string).</span>
</span><span id="get_clients_for_user-620"><a href="#get_clients_for_user-620"><span class="linenos">620</span></a><span class="sd">    Returns:</span>
</span><span id="get_clients_for_user-621"><a href="#get_clients_for_user-621"><span class="linenos">621</span></a><span class="sd">        list: Lista de organizaciones asignadas al usuario.</span>
</span><span id="get_clients_for_user-622"><a href="#get_clients_for_user-622"><span class="linenos">622</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_clients_for_user-623"><a href="#get_clients_for_user-623"><span class="linenos">623</span></a>    <span class="c1"># Obtener el usuario por su ID</span>
</span><span id="get_clients_for_user-624"><a href="#get_clients_for_user-624"><span class="linenos">624</span></a>    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="get_clients_for_user-625"><a href="#get_clients_for_user-625"><span class="linenos">625</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
</span><span id="get_clients_for_user-626"><a href="#get_clients_for_user-626"><span class="linenos">626</span></a>        <span class="k">return</span> <span class="p">[]</span>
</span><span id="get_clients_for_user-627"><a href="#get_clients_for_user-627"><span class="linenos">627</span></a>    <span class="c1"># Si el usuario es administrador, obtener todas las organizaciones</span>
</span><span id="get_clients_for_user-628"><a href="#get_clients_for_user-628"><span class="linenos">628</span></a>    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">is_admin</span><span class="p">():</span>
</span><span id="get_clients_for_user-629"><a href="#get_clients_for_user-629"><span class="linenos">629</span></a>        <span class="k">return</span> <span class="n">Organization</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span id="get_clients_for_user-630"><a href="#get_clients_for_user-630"><span class="linenos">630</span></a>    <span class="c1"># Si el usuario es reseller, obtener las organizaciones asignadas a su paquete</span>
</span><span id="get_clients_for_user-631"><a href="#get_clients_for_user-631"><span class="linenos">631</span></a>    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">is_reseller</span><span class="p">():</span>
</span><span id="get_clients_for_user-632"><a href="#get_clients_for_user-632"><span class="linenos">632</span></a>        <span class="n">reseller_package</span> <span class="o">=</span> <span class="p">(</span><span class="n">ResellerPackage</span><span class="o">.</span><span class="n">query</span>
</span><span id="get_clients_for_user-633"><a href="#get_clients_for_user-633"><span class="linenos">633</span></a>                             <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="n">ResellerPackage</span><span class="o">.</span><span class="n">organizations</span><span class="p">))</span>
</span><span id="get_clients_for_user-634"><a href="#get_clients_for_user-634"><span class="linenos">634</span></a>                             <span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">reseller_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">())</span>
</span><span id="get_clients_for_user-635"><a href="#get_clients_for_user-635"><span class="linenos">635</span></a>        <span class="k">if</span> <span class="n">reseller_package</span><span class="p">:</span>
</span><span id="get_clients_for_user-636"><a href="#get_clients_for_user-636"><span class="linenos">636</span></a>            <span class="k">return</span> <span class="n">reseller_package</span><span class="o">.</span><span class="n">organizations</span>
</span><span id="get_clients_for_user-637"><a href="#get_clients_for_user-637"><span class="linenos">637</span></a>    <span class="c1"># Si el usuario no es administrador ni reseller, obtener las organizaciones a las que está directamente asignado</span>
</span><span id="get_clients_for_user-638"><a href="#get_clients_for_user-638"><span class="linenos">638</span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">query</span>
</span><span id="get_clients_for_user-639"><a href="#get_clients_for_user-639"><span class="linenos">639</span></a>            <span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
</span><span id="get_clients_for_user-640"><a href="#get_clients_for_user-640"><span class="linenos">640</span></a>            <span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">organizations</span><span class="p">))</span>
</span><span id="get_clients_for_user-641"><a href="#get_clients_for_user-641"><span class="linenos">641</span></a>            <span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">organizations</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Obtiene el listado de clientes asignados a un usuario específico.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>user_id (str):</strong>  ID del usuario (UUID en formato string).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>list: Lista de organizaciones asignadas al usuario.</p>
</blockquote>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>